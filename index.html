<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>K-Online Bank Ultimate 2026</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://i.postimg.cc/QtVHC5G0/IMG-3035.jpg">
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <style>
        :root {
            --bg-color: #f2f6f9;
            --white: #ffffff;
            --black: #000000;
            --dark-grey: #1c1c1e;
            --light-grey: #8e8e93;
            --blue: #007aff;
            --red-grad: linear-gradient(170deg, #000a1a 0%, #1a0000 40%, #660000 100%);
            --gold-grad: linear-gradient(145deg, #bf953f 0%, #fcf6ba 45%, #b38728 70%, #fbf5b7 100%);
            --card-shadow: 0 15px 35px rgba(0,0,0,0.2);
            --block-shadow: 0 10px 25px rgba(0,0,0,0.05);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif;
            background-color: var(--bg-color); color: var(--dark-grey);
            overflow: hidden;
        }

        #snow-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999; }

        .screen { 
            display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: var(--bg-color); overflow-y: auto; padding-bottom: 50px;
            opacity: 0; transform: scale(0.97); transition: 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        .screen.active { display: block !important; opacity: 1; transform: scale(1); }

        /* Auth UI */
        .auth-screen { background: var(--white); height: 100vh; display: flex; flex-direction: column; justify-content: space-between; padding: 60px 40px 40px; text-align: center; }
        .logo-title { font-size: 60px; font-weight: 900; background: linear-gradient(45deg, #ff0000, #ffcc00); -webkit-background-clip: text; -webkit-text-fill-color: transparent; letter-spacing: -4px; margin: 0; }
        .input-field { width: 100%; height: 70px; border-radius: 22px; border: 2px solid #f2f2f2; background: #fafafa; padding: 0 25px; font-size: 18px; margin-bottom: 15px; font-weight: 600; transition: 0.3s; outline: none; }
        .input-field:focus { border-color: var(--blue); }
        .btn-primary { width: 100%; height: 70px; border-radius: 22px; border: none; font-size: 18px; font-weight: 800; cursor: pointer; transition: 0.2s; }
        .btn-primary:active { transform: scale(0.95); }
        .btn-dark { background: var(--black); color: var(--white); }

        /* App Header & Cards */
        .app-header { background: var(--red-grad); padding: 65px 0 40px; border-radius: 0 0 50px 50px; position: relative; box-shadow: 0 20px 40px rgba(0,0,0,0.25); }
        .user-row { display: flex; justify-content: space-between; align-items: center; padding: 0 30px; color: white; margin-bottom: 25px; }
        .card-scroller { display: flex; gap: 18px; padding: 0 30px; overflow-x: auto; scrollbar-width: none; padding-bottom: 10px; }
        .card-scroller::-webkit-scrollbar { display: none; }

        .bank-card { 
            min-width: 280px; height: 170px; border-radius: 30px; padding: 25px; 
            display: flex; flex-direction: column; justify-content: space-between;
            position: relative; flex-shrink: 0; box-shadow: var(--card-shadow);
        }
        .card-black { background: linear-gradient(160deg, #1c1c1e 0%, #000000 100%); color: white; }
        .card-gold { background: var(--gold-grad); color: #4a3500; }
        .chip { width: 42px; height: 32px; background: linear-gradient(135deg, #d4af37, #fcf6ba); border-radius: 8px; }

        /* Main Elements */
        .analytics-box { background: var(--white); margin: 25px; padding: 25px; border-radius: 35px; box-shadow: var(--block-shadow); }
        .stats-sum { font-size: 34px; font-weight: 900; color: var(--black); margin: 10px 0; }
        .progress-bg { width: 100%; height: 10px; background: #f0f0f0; border-radius: 10px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--black); width: 0%; border-radius: 10px; transition: 1.5s cubic-bezier(0.1, 0.5, 0.1, 1); }

        .actions-row { display: flex; justify-content: center; gap: 20px; margin-top: 25px; }
        .action-circle { 
            width: 62px; height: 62px; background: rgba(255,255,255,0.15); 
            border-radius: 20px; display: flex; align-items: center; justify-content: center; 
            font-size: 26px; backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1);
        }

        .history-item { 
            background: var(--white); margin: 0 25px 12px; padding: 20px; 
            border-radius: 25px; display: flex; justify-content: space-between; align-items: center;
            box-shadow: var(--block-shadow);
        }

        #frozen-overlay { position: fixed; inset: 0; background: var(--white); z-index: 10000; display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 40px; }
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 9999; align-items: center; justify-content: center; backdrop-filter: blur(15px); }
        .modal-body { background: var(--white); width: 88%; max-width: 400px; border-radius: 40px; padding: 40px; text-align: center; }
    </style>
</head>
<body>

    <canvas id="snow-canvas"></canvas>

    <div id="frozen-overlay">
        <div style="font-size: 100px;">‚ùÑÔ∏è</div>
        <h1>–î–æ—Å—Ç—É–ø –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</h1>
        <p>–í–∞—à –∞–∫–∫–∞—É–Ω—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–º–æ—Ä–æ–∂–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–µ–π.</p>
        <button class="btn-primary btn-dark" onclick="location.reload()">–û–±–Ω–æ–≤–∏—Ç—å</button>
    </div>

    <div id="screen-auth" class="screen active">
        <div class="auth-screen">
            <div><h1 class="logo-title">K-Online</h1></div>
            <div>
                <input type="number" id="auth-tg-id" class="input-field" placeholder="–í–∞—à Telegram ID">
                <button class="btn-primary btn-dark" onclick="bankApp.startAuth()">–í–æ–π—Ç–∏</button>
                <button style="border:none; background:none; color:var(--blue); margin-top:20px; font-weight:600;" onclick="bankApp.toggleModal('modal-reg', true)">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
            </div>
            <div style="color:#ccc; font-size:12px;">v.4.0.1 Stable Edition</div>
        </div>
    </div>

    <div id="screen-otp" class="screen">
        <div class="auth-screen">
            <div style="font-size: 34px;" onclick="bankApp.nav('screen-auth')">‚Üê</div>
            <h2>–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</h2>
            <p>–ú—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥ –≤ –≤–∞—à Telegram</p>
            <input type="number" id="auth-otp-input" class="input-field" style="text-align:center; font-size:32px; letter-spacing:8px;">
            <button class="btn-primary btn-dark" onclick="bankApp.verifyOTP()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
            <div style="height: 100px;"></div>
        </div>
    </div>

    <div id="screen-home" class="screen">
        <div class="app-header">
            <div class="user-row">
                <div>
                    <small style="opacity:0.7;">–ü—Ä–∏–≤–µ—Ç,</small>
                    <h2 id="display-user-name" style="margin:0;">–ó–∞–≥—Ä—É–∑–∫–∞...</h2>
                </div>
                <div id="display-user-ava" style="width:50px; height:50px; background:rgba(255,255,255,0.2); border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:bold; font-size:20px;">?</div>
            </div>
            
            <div class="card-scroller" id="card-scroller-inner">
                </div>

            <div class="actions-row">
                <div class="action-circle" onclick="bankApp.nav('screen-transfer')">üéÅ</div>
                <div class="action-circle" onclick="bankApp.nav('screen-history')">üìú</div>
                <div id="admin-trigger" class="action-circle" style="display:none; background:#f1c40f;" onclick="bankApp.nav('screen-admin')">üõ°Ô∏è</div>
                <div class="action-circle" onclick="location.reload()">üö™</div>
            </div>
        </div>

        <div class="analytics-box">
            <div style="color:var(--light-grey); font-size:12px; font-weight:700;">–¢–†–ê–¢–´ –ó–ê –ú–ï–°–Ø–¶</div>
            <div class="stats-sum" id="stats-spent-val">0 ‚ÇΩ</div>
            <div class="progress-bg"><div class="progress-fill" id="stats-progress"></div></div>
        </div>

        <div style="padding: 0 25px;">
            <button class="btn-primary" style="background:var(--gold-grad); color:#4a3500;" onclick="bankApp.takeCredit()">–ü–æ–ª—É—á–∏—Ç—å –±—ã—Å—Ç—Ä—ã–π –∫—Ä–µ–¥–∏—Ç</button>
        </div>
    </div>

    <div id="screen-transfer" class="screen">
        <div style="padding: 60px 30px;">
            <div style="font-size: 34px;" onclick="bankApp.nav('screen-home')">‚Üê</div>
            <h2>–ù–æ–≤—ã–π –ø–µ—Ä–µ–≤–æ–¥</h2>
            <div style="background:white; padding:25px; border-radius:35px; box-shadow:var(--block-shadow); margin-top:20px;">
                <label style="font-size:12px; color:var(--light-grey); font-weight:700;">–ü–û–õ–£–ß–ê–¢–ï–õ–¨</label>
                <select id="transfer-target" class="input-field" style="margin-top:10px;"></select>
                
                <label style="font-size:12px; color:var(--light-grey); font-weight:700;">–°–£–ú–ú–ê (‚ÇΩ)</label>
                <input type="number" id="transfer-amount" class="input-field" placeholder="0">
                
                <button class="btn-primary btn-dark" onclick="bankApp.processTransfer()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–µ–Ω—å–≥–∏</button>
            </div>
        </div>
    </div>

    <div id="screen-history" class="screen">
        <div style="padding: 60px 25px;">
            <div style="font-size: 34px;" onclick="bankApp.nav('screen-home')">‚Üê</div>
            <h2>–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</h2>
            <div id="history-list-full" style="margin-top:20px;"></div>
        </div>
    </div>

    <div id="screen-admin" class="screen">
        <div style="padding: 60px 25px;">
            <div style="font-size: 34px;" onclick="bankApp.nav('screen-home')">‚Üê</div>
            <h2>–ú–æ–¥–µ—Ä–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–µ–π</h2>
            <div id="admin-pending-list" style="margin-top:20px;"></div>
        </div>
    </div>

    <div id="modal-reg" class="modal-overlay">
        <div class="modal-body">
            <h2 style="margin-top:0;">–ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç</h2>
            <input type="text" id="reg-name" class="input-field" placeholder="–í–∞—à–µ –ò–º—è">
            <input type="number" id="reg-tg" class="input-field" placeholder="Telegram ID">
            <button class="btn-primary btn-dark" onclick="bankApp.register()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
            <p style="color:var(--light-grey); margin-top:20px;" onclick="bankApp.toggleModal('modal-reg', false)">–û—Ç–º–µ–Ω–∞</p>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        const BOT_TOKEN = "8548215166:AAHhHo_ODrDZl-6Lg5Zi-BpBIpeMzXdOEFE";
        const ADMIN_ID = "7597506775";

        const firebaseConfig = { 
            apiKey: "AIzaSyA3J7KnUgxUHZigwRKmndm7xyxJeeLCrxg", 
            databaseURL: "https://webapp-b7149-default-rtdb.europe-west1.firebasedatabase.app", 
            projectId: "webapp-b7149" 
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const bankApp = {
            state: { allUsers: [], user: null, otp: null, candidate: null },

            nav: (id) => {
                document.querySelectorAll('.screen').forEach(s => {
                    s.classList.remove('active');
                    setTimeout(() => { if(!s.classList.contains('active')) s.style.display = 'none' }, 400);
                });
                const el = document.getElementById(id);
                el.style.display = 'block';
                setTimeout(() => el.classList.add('active'), 50);
            },

            toggleModal: (id, show) => document.getElementById(id).style.display = show ? 'flex' : 'none',

            startAuth: async () => {
                const tid = document.getElementById('auth-tg-id').value;
                if(!tid) return alert("–í–≤–µ–¥–∏—Ç–µ ID");
                const user = bankApp.state.allUsers.find(u => u.tg_id == tid);
                if (!user) return alert("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ");
                
                bankApp.state.otp = Math.floor(100000 + Math.random() * 900000);
                bankApp.state.candidate = user;
                
                try {
                    await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage?chat_id=${tid}&text=–í–∞—à –∫–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ K-Online: ${bankApp.state.otp}`);
                    bankApp.nav('screen-otp');
                } catch(e) { alert("–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏ —Å Telegram"); }
            },

            verifyOTP: () => {
                const input = document.getElementById('auth-otp-input').value;
                if (input == bankApp.state.otp) {
                    bankApp.state.user = bankApp.state.candidate;
                    bankApp.renderUI();
                    bankApp.nav('screen-home');
                } else {
                    alert("–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥");
                }
            },

            register: () => {
                const name = document.getElementById('reg-name').value;
                const tg = document.getElementById('reg-tg').value;
                if (!name || !tg) return alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è");
                
                db.ref('clients').push({ 
                    name, 
                    tg_id: tg, 
                    balance: 1000, 
                    isFrozen: false, 
                    hasCredit: false,
                    history: { "init": {title: "–ë–æ–Ω—É—Å –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é", sum: 1000, date: Date.now()} }
                });
                bankApp.toggleModal('modal-reg', false);
                alert("–ê–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω! –¢–µ–ø–µ—Ä—å –≤–æ–π–¥–∏—Ç–µ –ø–æ ID.");
            },

            processTransfer: async () => {
                const targetKey = document.getElementById('transfer-target').value;
                const amount = parseInt(document.getElementById('transfer-amount').value);
                const sender = bankApp.state.user;
                const receiver = bankApp.state.allUsers.find(u => u.fbKey === targetKey);

                if (!amount || amount <= 0) return alert("–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É");
                if (sender.balance < amount) return alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤");

                if (amount >= 1000) {
                    // –ú–æ–¥–µ—Ä–∞—Ü–∏—è
                    await db.ref(`clients/${sender.fbKey}/balance`).set(sender.balance - amount);
                    db.ref('moderation').push({
                        from: sender.fbKey, fromN: sender.name, fromT: sender.tg_id,
                        to: targetKey, toN: receiver.name, toT: receiver.tg_id,
                        sum: amount, date: Date.now()
                    });
                    fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage?chat_id=${ADMIN_ID}&text=üí≥ –ö—Ä—É–ø–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥! \n–û—Ç: ${sender.name} (${amount}‚ÇΩ)\n–ö–æ–º—É: ${receiver.name}\n–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤ –ø–∞–Ω–µ–ª–∏.`);
                    alert("–ü–µ—Ä–µ–≤–æ–¥—ã —Å–≤—ã—à–µ 1000‚ÇΩ –ø—Ä–æ—Ö–æ–¥—è—Ç –º–æ–¥–µ—Ä–∞—Ü–∏—é. –û–∂–∏–¥–∞–π—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.");
                } else {
                    // –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π
                    await db.ref(`clients/${sender.fbKey}/balance`).set(sender.balance - amount);
                    await db.ref(`clients/${targetKey}/balance`).transaction(c => (c || 0) + amount);
                    
                    db.ref(`clients/${sender.fbKey}/history`).push({ title: `–ü–µ—Ä–µ–≤–æ–¥: ${receiver.name}`, sum: -amount, date: Date.now() });
                    db.ref(`clients/${targetKey}/history`).push({ title: `–í—Ö–æ–¥—è—â–∏–π: ${sender.name}`, sum: amount, date: Date.now() });
                    alert("–ü–µ—Ä–µ–≤–æ–¥ —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω!");
                }
                bankApp.nav('screen-home');
            },

            takeCredit: () => {
                if(bankApp.state.user.hasCredit) return alert("–£ –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π –∫—Ä–µ–¥–∏—Ç");
                db.ref(`clients/${bankApp.state.user.fbKey}`).update({ 
                    hasCredit: true,
                    balance: bankApp.state.user.balance + 50000 
                });
                db.ref(`clients/${bankApp.state.user.fbKey}/history`).push({ title: "–í—ã–¥–∞—á–∞ –∫—Ä–µ–¥–∏—Ç–∞", sum: 50000, date: Date.now() });
                alert("–í–∞–º –æ–¥–æ–±—Ä–µ–Ω –∫—Ä–µ–¥–∏—Ç –Ω–∞ 50,000 ‚ÇΩ");
            },

            adminAction: async (key, data, isApprove) => {
                if (isApprove) {
                    await db.ref(`clients/${data.to}/balance`).transaction(c => (c || 0) + data.sum);
                    db.ref(`clients/${data.from}/history`).push({ title: `–ò—Å–ø–æ–ª–Ω–µ–Ω–æ: ${data.toN}`, sum: -data.sum, date: Date.now() });
                    db.ref(`clients/${data.to}/history`).push({ title: `–û—Ç: ${data.fromN}`, sum: data.sum, date: Date.now() });
                } else {
                    await db.ref(`clients/${data.from}/balance`).transaction(c => (c || 0) + data.sum);
                    db.ref(`clients/${data.from}/history`).push({ title: `–û—Ç–º–µ–Ω–∞ (–≤–æ–∑–≤—Ä–∞—Ç): ${data.sum}‚ÇΩ`, sum: 0, date: Date.now() });
                }
                db.ref(`moderation/${key}`).remove();
            },

            renderUI: () => {
                const u = bankApp.state.user;
                if (!u) return;

                if (u.isFrozen) {
                    document.getElementById('frozen-overlay').style.display = 'flex';
                } else {
                    document.getElementById('frozen-overlay').style.display = 'none';
                }

                document.getElementById('display-user-name').innerText = u.name;
                document.getElementById('display-user-ava').innerText = u.name[0].toUpperCase();
                document.getElementById('admin-trigger').style.display = (u.tg_id == ADMIN_ID) ? 'flex' : 'none';

                // –ö–∞—Ä—Ç—ã
                let cardsHTML = `
                    <div class="bank-card card-black">
                        <div class="chip"></div>
                        <div>
                            <div style="font-size:12px; opacity:0.6; margin-bottom:5px;">–û—Å–Ω–æ–≤–Ω–æ–π –±–∞–ª–∞–Ω—Å</div>
                            <div style="font-size:28px; font-weight:800;">${(u.balance || 0).toLocaleString()} ‚ÇΩ</div>
                        </div>
                    </div>
                `;
                if (u.hasCredit) {
                    cardsHTML += `
                        <div class="bank-card card-gold">
                            <div class="chip"></div>
                            <div>
                                <div style="font-size:12px; opacity:0.6; margin-bottom:5px;">–ö—Ä–µ–¥–∏—Ç–Ω—ã–π –ª–∏–º–∏—Ç</div>
                                <div style="font-size:28px; font-weight:800;">50,000 ‚ÇΩ</div>
                            </div>
                        </div>
                    `;
                }
                document.getElementById('card-scroller-inner').innerHTML = cardsHTML;

                // –ò—Å—Ç–æ—Ä–∏—è
                const hData = u.history ? Object.values(u.history).sort((a,b) => b.date - a.date) : [];
                document.getElementById('history-list-full').innerHTML = hData.map(h => `
                    <div class="history-item">
                        <div><b>${h.title}</b><br><small style="color:#aaa">${new Date(h.date).toLocaleDateString()}</small></div>
                        <div style="font-weight:900; color:${h.sum > 0 ? '#2ecc71' : (h.sum < 0 ? '#ff3b30' : '#000')}">
                            ${h.sum > 0 ? '+' : ''}${h.sum.toLocaleString()} ‚ÇΩ
                        </div>
                    </div>
                `).join('') || "<p style='text-align:center; color:#888;'>–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</p>";

                // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ (—Ç—Ä–∞—Ç—ã)
                const spent = hData.filter(h => h.sum < 0).reduce((a, b) => a + Math.abs(b.sum), 0);
                document.getElementById('stats-spent-val').innerText = spent.toLocaleString() + " ‚ÇΩ";
                document.getElementById('stats-progress').style.width = Math.min(spent / 1000, 100) + "%";

                // –°–ø–∏—Å–æ–∫ –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞
                document.getElementById('transfer-target').innerHTML = bankApp.state.allUsers
                    .filter(x => x.fbKey !== u.fbKey)
                    .map(x => `<option value="${x.fbKey}">${x.name}</option>`)
                    .join('');
            }
        };

        // Listeners
        db.ref('clients').on('value', snap => {
            const d = snap.val();
            bankApp.state.allUsers = d ? Object.keys(d).map(k => ({...d[k], fbKey: k})) : [];
            if (bankApp.state.user) {
                bankApp.state.user = bankApp.state.allUsers.find(u => u.fbKey === bankApp.state.user.fbKey);
                bankApp.renderUI();
            }
        });

        db.ref('moderation').on('value', snap => {
            const mod = snap.val();
            const box = document.getElementById('admin-pending-list');
            if(!mod) return box.innerHTML = "<p style='text-align:center;'>–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞—è–≤–æ–∫</p>";
            
            box.innerHTML = Object.keys(mod).map(k => `
                <div class="history-item">
                    <div style="text-align:left;">
                        <b style="color:var(--blue);">${mod[k].sum}‚ÇΩ</b><br>
                        <small>${mod[k].fromN} ‚Æï ${mod[k].toN}</small>
                    </div>
                    <div style="display:flex; gap:10px;">
                        <button style="border:none; background:#e1ffed; border-radius:10px; padding:10px;" onclick='bankApp.adminAction("${k}", ${JSON.stringify(mod[k])}, true)'>‚úÖ</button>
                        <button style="border:none; background:#ffe1e1; border-radius:10px; padding:10px;" onclick='bankApp.adminAction("${k}", ${JSON.stringify(mod[k])}, false)'>‚ùå</button>
                    </div>
                </div>
            `).join('');
        });

        // Snow Animation
        const canvas = document.getElementById('snow-canvas');
        const ctx = canvas.getContext('2d');
        let flakes = [];
        function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        window.onresize = resize; resize();
        for(let i=0; i<60; i++) flakes.push({ x: Math.random()*canvas.width, y: Math.random()*canvas.height, r: Math.random()*3+1, v: Math.random()*0.8+0.2 });
        function draw() {
            ctx.clearRect(0,0,canvas.width,canvas.height); 
            ctx.fillStyle = "rgba(255,255,255,0.7)"; 
            ctx.beginPath();
            flakes.forEach(f => { 
                ctx.moveTo(f.x, f.y); 
                ctx.arc(f.x, f.y, f.r, 0, Math.PI*2); 
                f.y += f.v; 
                if(f.y > canvas.height) f.y = -5; 
            });
            ctx.fill(); 
            requestAnimationFrame(draw);
        }
        draw();
    </script>
</body>
</html>
