<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>K-Online Pro | Premium Banking</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#21a038">
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <style>
        :root {
            --sber-green: #21a038;
            --sber-dark: #083d12;
            --bg-main: #f4f6f8;
            --white: #ffffff;
            --text-main: #1a1a1a;
            --text-gray: #8e8e93;
            --accent-blue: #007aff;
            --shadow: 0 8px 24px rgba(0,0,0,0.08);
            --card-grad: linear-gradient(135deg, #2c3e50, #000000);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        
        body { 
            margin: 0; padding: 0; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: var(--bg-main); color: var(--text-main);
            overflow: hidden; height: 100vh; width: 100vw;
        }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É —ç–∫—Ä–∞–Ω–∞–º–∏ */
        .screen {
            display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            overflow-y: auto; background: var(--bg-main);
            padding-bottom: 80px; 
            animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .screen.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* HEADER & TOP NAV */
        .header-main {
            background: var(--sber-green);
            padding: 55px 20px 25px;
            color: white;
            border-radius: 0 0 30px 30px;
            box-shadow: 0 4px 12px rgba(33, 160, 56, 0.2);
        }
        .user-profile { display: flex; align-items: center; justify-content: space-between; margin-bottom: 25px; }
        .avatar { 
            width: 45px; height: 45px; background: rgba(255,255,255,0.2); 
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-weight: bold; font-size: 20px; border: 1px solid rgba(255,255,255,0.4);
        }

        /* –ö–ê–†–¢–´ */
        .card-carousel { 
            display: flex; overflow-x: auto; gap: 15px; padding: 10px 0;
            scroll-snap-type: x mandatory; scrollbar-width: none;
        }
        .card-carousel::-webkit-scrollbar { display: none; }
        
        .bank-card {
            min-width: 280px; height: 160px; background: var(--card-grad);
            border-radius: 20px; padding: 20px; color: white;
            position: relative; scroll-snap-align: center;
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }
        .card-mir { background: linear-gradient(135deg, #005a2d, #00a651); }
        .card-credit { background: linear-gradient(135deg, #434343, #000000); }
        
        .card-type { font-size: 10px; text-transform: uppercase; letter-spacing: 1px; opacity: 0.8; }
        .card-balance { font-size: 28px; font-weight: 800; margin: 15px 0; }
        .card-number { font-family: monospace; font-size: 16px; opacity: 0.7; }

        /* –í–ò–î–ñ–ï–¢–´ –ò –ö–ù–û–ü–ö–ò */
        .section-title { padding: 20px 20px 10px; font-size: 18px; font-weight: 700; }
        
        .action-grid {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; padding: 0 20px;
        }
        .action-item { text-align: center; }
        .action-circle {
            width: 55px; height: 55px; background: white; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            margin: 0 auto 8px; font-size: 22px; box-shadow: var(--shadow);
        }
        .action-label { font-size: 11px; font-weight: 600; color: #444; }

        .widget-list { padding: 10px 20px; }
        .widget-item {
            background: white; border-radius: 18px; padding: 16px;
            display: flex; align-items: center; gap: 15px; margin-bottom: 12px;
            box-shadow: var(--shadow); transition: transform 0.2s;
        }
        .widget-item:active { transform: scale(0.97); }
        .widget-icon { 
            width: 44px; height: 44px; border-radius: 12px; 
            display: flex; align-items: center; justify-content: center; font-size: 20px;
        }

        /* –ò–°–¢–û–†–ò–Ø */
        .history-card {
            background: white; border-radius: 25px 25px 0 0; 
            margin-top: 20px; padding: 25px 20px; min-height: 400px;
        }
        .op-row {
            display: flex; align-items: center; justify-content: space-between;
            padding: 15px 0; border-bottom: 1px solid #f0f0f0;
        }
        .op-info { display: flex; flex-direction: column; }
        .op-title { font-weight: 600; font-size: 15px; }
        .op-date { font-size: 12px; color: var(--text-gray); margin-top: 3px; }
        .op-amount { font-weight: 700; font-size: 16px; }
        .amount-minus { color: #000; }
        .amount-plus { color: var(--sber-green); }

        /* –§–û–†–ú–´ */
        .form-group { padding: 20px; }
        .input-box {
            background: white; border-radius: 15px; padding: 15px;
            margin-bottom: 15px; box-shadow: var(--shadow);
        }
        input, select {
            width: 100%; border: none; font-size: 17px; font-weight: 600;
            padding: 10px 0; color: var(--text-main);
        }
        label { font-size: 12px; color: var(--text-gray); font-weight: 700; }
        
        .btn-pay {
            background: var(--sber-green); color: white; border: none;
            width: 100%; height: 55px; border-radius: 15px;
            font-size: 17px; font-weight: 700; margin-top: 10px;
        }

        /* –≠–ö–†–ê–ù –í–•–û–î–ê */
        #screen-auth {
            background: linear-gradient(160deg, var(--sber-green) 0%, #0d4d1d 100%);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 1000;
        }
        .auth-container {
            width: 85%; background: rgba(255,255,255,0.95);
            padding: 30px 20px; border-radius: 30px; backdrop-filter: blur(10px);
            text-align: center; box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
        .auth-title { font-size: 26px; font-weight: 900; color: var(--sber-dark); margin-bottom: 10px; }
        .user-select-list { max-height: 200px; overflow-y: auto; margin: 20px 0; }
        .user-option {
            padding: 15px; border-bottom: 1px solid #eee; font-weight: 700;
            display: flex; justify-content: space-between;
        }
        .user-option.selected { color: var(--sber-green); border-left: 4px solid var(--sber-green); }

    </style>
</head>
<body>

    <div id="screen-auth" class="screen active">
        <div class="auth-container">
            <div class="auth-title">K-Online Pro</div>
            <div style="color: #666; font-size: 14px;">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å –¥–ª—è –≤—Ö–æ–¥–∞</div>
            <div id="userListUI" class="user-select-list"></div>
            <button class="btn-pay" onclick="loginAction()">–í–æ–π—Ç–∏ –≤ –∫–∞–±–∏–Ω–µ—Ç</button>
            <div onclick="registerNew()" style="margin-top: 20px; font-weight: 700; font-size: 13px; color: #555;">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∞–∫–∫–∞—É–Ω—Ç</div>
        </div>
    </div>

    <div id="screen-home" class="screen">
        <div class="header-main">
            <div class="user-profile">
                <div>
                    <div style="opacity: 0.8; font-size: 13px;">–î–æ–±—Ä—ã–π –¥–µ–Ω—å,</div>
                    <div id="userName" style="font-size: 22px; font-weight: 800;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                </div>
                <div class="avatar" id="userAvatar">?</div>
            </div>
            
            <div class="card-carousel">
                <div class="bank-card card-mir" onclick="openCardDetails('debit')">
                    <div class="card-type">–î–µ–±–µ—Ç–æ–≤–∞—è –∫–∞—Ä—Ç–∞ ‚Ä¢ –ú–ò–†</div>
                    <div class="card-balance" id="bal-debit">0 ‚ÇΩ</div>
                    <div class="card-number">‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 4002</div>
                </div>
                <div class="bank-card card-credit" onclick="openCardDetails('credit')">
                    <div class="card-type">–ö—Ä–µ–¥–∏—Ç–Ω–∞—è –∫–∞—Ä—Ç–∞</div>
                    <div class="card-balance" id="bal-credit">0 ‚ÇΩ</div>
                    <div class="card-number">‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 8851</div>
                </div>
            </div>
        </div>

        <div class="section-title">–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</div>
        <div class="action-grid">
            <div class="action-item" onclick="nav('screen-transfer')">
                <div class="action-circle">üí∏</div>
                <div class="action-label">–ü–µ—Ä–µ–≤–æ–¥</div>
            </div>
            <div class="action-item" onclick="nav('screen-payments')">
                <div class="action-circle">üì±</div>
                <div class="action-label">–ü–ª–∞—Ç–µ–∂–∏</div>
            </div>
            <div class="action-item" onclick="openExchange()">
                <div class="action-circle">üí±</div>
                <div class="action-label">–û–±–º–µ–Ω</div>
            </div>
            <div class="action-item" onclick="nav('screen-settings')">
                <div class="action-circle">‚öôÔ∏è</div>
                <div class="action-label">–ò–Ω—Ñ–æ</div>
            </div>
        </div>

        <div class="section-title">–°–µ—Ä–≤–∏—Å—ã</div>
        <div class="widget-list">
            <div class="widget-item">
                <div class="widget-icon" style="background: #e3f2fd; color: #1e88e5;">‚≠ê</div>
                <div style="flex: 1;">
                    <div style="font-weight: 700; font-size: 15px;">–ë–æ–Ω—É—Å—ã</div>
                    <div id="userBonus" style="font-size: 13px; color: var(--sber-green); font-weight: 700;">0</div>
                </div>
                <div style="font-size: 12px; color: #999;">–ù–∞–∫–æ–ø–ª–µ–Ω–æ ‚ûú</div>
            </div>
            <div class="widget-item" onclick="openExchange()">
                <div class="widget-icon" style="background: #fff8e1; color: #fbc02d;">üíµ</div>
                <div style="flex: 1;">
                    <div style="font-weight: 700; font-size: 15px;">–í–∞–ª—é—Ç–Ω—ã–π —Å—á–µ—Ç</div>
                    <div id="userUsd" style="font-size: 13px; color: #666;">$ 0.00</div>
                </div>
            </div>
        </div>
    </div>

    <div id="screen-transfer" class="screen">
        <div class="header-main" style="padding-top: 40px; border-radius: 0 0 20px 20px;">
            <div onclick="nav('screen-home')" style="font-weight: 600;">‚úï –ó–∞–∫—Ä—ã—Ç—å</div>
            <h2 style="margin-top: 15px;">–ü–µ—Ä–µ–≤–æ–¥ –∫–ª–∏–µ–Ω—Ç—É</h2>
        </div>
        <div class="form-group">
            <div class="input-box">
                <label>–ö–æ–º—É –ø–µ—Ä–µ–≤–æ–¥–∏–º</label>
                <select id="select-recipient"></select>
            </div>
            <div class="input-box">
                <label>–°—É–º–º–∞ –ø–µ—Ä–µ–≤–æ–¥–∞ (‚ÇΩ)</label>
                <input type="number" id="input-sum" placeholder="0">
            </div>
            <button class="btn-pay" onclick="executeTransfer()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–µ–Ω—å–≥–∏</button>
        </div>
    </div>

    <div id="screen-payments" class="screen">
        <div class="header-main" style="padding-top: 40px; border-radius: 0 0 20px 20px;">
            <div onclick="nav('screen-home')" style="font-weight: 600;">‚úï –ó–∞–∫—Ä—ã—Ç—å</div>
            <h2 style="margin-top: 15px;">–ü–ª–∞—Ç–µ–∂–∏ –∏ —É—Å–ª—É–≥–∏</h2>
        </div>
        <div class="widget-list" style="margin-top: 20px;">
            <div class="widget-item" onclick="startServicePay('–ú–æ–±–∏–ª—å–Ω–∞—è —Å–≤—è–∑—å', 'üì±')">
                <div class="widget-icon">üì±</div>
                <div style="font-weight: 700;">–ú–æ–±–∏–ª—å–Ω–∞—è —Å–≤—è–∑—å</div>
            </div>
            <div class="widget-item" onclick="startServicePay('–î–æ–º–∞—à–Ω–∏–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç', 'üåê')">
                <div class="widget-icon">üåê</div>
                <div style="font-weight: 700;">–ò–Ω—Ç–µ—Ä–Ω–µ—Ç</div>
            </div>
            <div class="widget-item" onclick="startServicePay('–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç (–¢—Ä–æ–π–∫–∞)', 'üöå')">
                <div class="widget-icon">üöå</div>
                <div style="font-weight: 700;">–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</div>
            </div>
        </div>
    </div>

    <div id="screen-card-detail" class="screen">
        <div style="padding: 40px 20px 20px; background: white;">
            <div onclick="nav('screen-home')" style="color: var(--accent-blue); font-weight: 600;">‚Üê –ù–∞–∑–∞–¥</div>
            <h1 id="detail-bal-title" style="font-size: 34px; margin: 20px 0 5px;">0 ‚ÇΩ</h1>
            <div id="detail-card-name" style="color: var(--text-gray); font-weight: 600;">–î–µ–±–µ—Ç–æ–≤–∞—è –∫–∞—Ä—Ç–∞</div>
        </div>
        
        <div class="action-grid" style="margin-top: 10px;">
            <div class="action-item" onclick="topUpBalance()">
                <div class="action-circle">üì•</div>
                <div class="action-label">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</div>
            </div>
            <div class="action-item" onclick="alert('–†–µ–∫–≤–∏–∑–∏—Ç—ã: RU89 2100 0000 4002 9912')">
                <div class="action-circle">üìÑ</div>
                <div class="action-label">–†–µ–∫–≤–∏–∑–∏—Ç—ã</div>
            </div>
            <div class="action-item" onclick="toggleFreeze()">
                <div class="action-circle">‚ùÑÔ∏è</div>
                <div class="action-label" id="freeze-label">–ë–ª–æ–∫</div>
            </div>
        </div>

        <div class="history-card">
            <div style="font-weight: 800; font-size: 18px; margin-bottom: 20px;">–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</div>
            <div id="history-list">
                </div>
        </div>
    </div>

    <script>
        const firebaseConfig = { 
            apiKey: "AIzaSyA3J7KnUgxUHZigwRKmndm7xyxJeeLCrxg", 
            databaseURL: "https://webapp-b7149-default-rtdb.europe-west1.firebasedatabase.app", 
            projectId: "webapp-b7149"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let currentUser = null;
        let allUsers = [];
        let selectedUserId = null;
        let currentDetailType = 'debit';

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function initApp() {
            db.ref('clients').on('value', snap => {
                const data = snap.val();
                allUsers = data ? Object.keys(data).map(key => ({ ...data[key], fbKey: key })) : [];
                renderUserSelect();
                if(currentUser) {
                    currentUser = allUsers.find(u => u.fbKey === currentUser.fbKey);
                    updateUI();
                }
            });
        }

        // –†–µ–Ω–¥–µ—Ä —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –≤—Ö–æ–¥–µ
        function renderUserSelect() {
            const container = document.getElementById('userListUI');
            container.innerHTML = allUsers.map(user => `
                <div class="user-option ${selectedUserId === user.fbKey ? 'selected' : ''}" onclick="selectUser('${user.fbKey}')">
                    ${user.name} <span>${selectedUserId === user.fbKey ? '‚óè' : ''}</span>
                </div>
            `).join('');

            // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π –≤ –ø–µ—Ä–µ–≤–æ–¥–∞—Ö
            const select = document.getElementById('select-recipient');
            select.innerHTML = allUsers
                .filter(u => currentUser && u.fbKey !== currentUser.fbKey)
                .map(u => `<option value="${u.fbKey}">${u.name}</option>`).join('');
        }

        function selectUser(id) {
            selectedUserId = id;
            renderUserSelect();
        }

        function loginAction() {
            if(!selectedUserId) return alert("–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è");
            const pin = prompt("–í–≤–µ–¥–∏—Ç–µ –ü–ò–ù-–∫–æ–¥ (4 —Ü–∏—Ñ—Ä—ã):");
            const user = allUsers.find(u => u.fbKey === selectedUserId);
            
            if(user && user.clientPin === pin) {
                currentUser = user;
                updateUI();
                nav('screen-home');
            } else {
                alert("–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥ –¥–æ—Å—Ç—É–ø–∞");
            }
        }

        function registerNew() {
            const name = prompt("–í–≤–µ–¥–∏—Ç–µ –í–∞—à–µ –§–ò–û:");
            const pin = prompt("–ü—Ä–∏–¥—É–º–∞–π—Ç–µ 4-–∑–Ω–∞—á–Ω—ã–π –ü–ò–ù-–∫–æ–¥:");
            if(name && pin) {
                db.ref('clients').push({
                    name: name,
                    clientPin: pin,
                    balance: 5000,
                    bonus: 100,
                    creditBalance: 0,
                    creditLimit: 50000,
                    usd: 0,
                    history: { "init": { title: "–û—Ç–∫—Ä—ã—Ç–∏–µ —Å—á–µ—Ç–∞", sum: 5000, date: new Date().toLocaleDateString() } }
                });
                alert("–ê–∫–∫–∞—É–Ω—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!");
            }
        }

        function updateUI() {
            if(!currentUser) return;
            
            // –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω
            document.getElementById('userName').innerText = currentUser.name;
            document.getElementById('userAvatar').innerText = currentUser.name.charAt(0);
            document.getElementById('bal-debit').innerText = (currentUser.balance || 0).toLocaleString() + " ‚ÇΩ";
            document.getElementById('bal-credit').innerText = (currentUser.creditLimit - (currentUser.creditBalance || 0)).toLocaleString() + " ‚ÇΩ";
            document.getElementById('userBonus').innerText = (currentUser.bonus || 0).toLocaleString();
            document.getElementById('userUsd').innerText = "$ " + (currentUser.usd || 0).toFixed(2);

            // –≠–∫—Ä–∞–Ω –¥–µ—Ç–∞–ª–µ–π, –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç
            if(document.getElementById('screen-card-detail').classList.contains('active')) {
                renderDetails();
            }
        }

        function nav(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        // –ü–ï–†–ï–í–û–î–´
        function executeTransfer() {
            const targetId = document.getElementById('select-recipient').value;
            const amount = parseInt(document.getElementById('input-sum').value);
            const targetUser = allUsers.find(u => u.fbKey === targetId);

            if(!amount || amount <= 0) return alert("–£–∫–∞–∂–∏—Ç–µ —Å—É–º–º—É");
            if(currentUser.balance < amount) return alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤");

            // –°–ø–∏—Å–∞–Ω–∏–µ
            db.ref(`clients/${currentUser.fbKey}`).update({ balance: currentUser.balance - amount });
            db.ref(`clients/${currentUser.fbKey}/history`).push({ 
                title: "–ü–µ—Ä–µ–≤–æ–¥: " + targetUser.name, 
                sum: -amount, 
                date: new Date().toLocaleDateString() 
            });

            // –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ
            db.ref(`clients/${targetId}`).update({ balance: (targetUser.balance || 0) + amount });
            db.ref(`clients/${targetId}/history`).push({ 
                title: "–í—Ö–æ–¥—è—â–∏–π –æ—Ç: " + currentUser.name, 
                sum: amount, 
                date: new Date().toLocaleDateString() 
            });

            alert("–ü–µ—Ä–µ–≤–æ–¥ —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω!");
            nav('screen-home');
        }

        // –û–ü–õ–ê–¢–ê –£–°–õ–£–ì
        function startServicePay(serviceName, icon) {
            const amount = prompt(`–û–ø–ª–∞—Ç–∞: ${serviceName}\n–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É (‚ÇΩ):`);
            if(!amount || isNaN(amount)) return;
            const sum = parseInt(amount);

            if(currentUser.balance < sum) return alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤");

            const bBonus = Math.floor(sum * 0.01); // 1% –±–æ–Ω—É—Å
            
            db.ref(`clients/${currentUser.fbKey}`).update({ 
                balance: currentUser.balance - sum,
                bonus: (currentUser.bonus || 0) + bBonus
            });
            db.ref(`clients/${currentUser.fbKey}/history`).push({ 
                title: "–û–ø–ª–∞—Ç–∞: " + serviceName, 
                sum: -sum, 
                date: new Date().toLocaleDateString() 
            });

            alert(`–£—Å–ø–µ—à–Ω–æ –æ–ø–ª–∞—á–µ–Ω–æ!\n–ù–∞—á–∏—Å–ª–µ–Ω–æ –±–æ–Ω—É—Å–æ–≤: ${bBonus}`);
        }

        // –ò–°–¢–û–†–ò–Ø –ò –î–ï–¢–ê–õ–ò
        function openCardDetails(type) {
            currentDetailType = type;
            nav('screen-card-detail');
            renderDetails();
        }

        function renderDetails() {
            const hList = document.getElementById('history-list');
            const balTitle = document.getElementById('detail-bal-title');
            const nameTitle = document.getElementById('detail-card-name');

            if(currentDetailType === 'debit') {
                balTitle.innerText = currentUser.balance.toLocaleString() + " ‚ÇΩ";
                nameTitle.innerText = "–î–µ–±–µ—Ç–æ–≤–∞—è –∫–∞—Ä—Ç–∞ ‚Ä¢ –ú–ò–†";
            } else {
                balTitle.innerText = (currentUser.creditLimit - (currentUser.creditBalance || 0)).toLocaleString() + " ‚ÇΩ";
                nameTitle.innerText = "–ö—Ä–µ–¥–∏—Ç–Ω–∞—è –∫–∞—Ä—Ç–∞";
            }

            const historyArr = currentUser.history ? Object.values(currentUser.history).reverse() : [];
            hList.innerHTML = historyArr.map(h => `
                <div class="op-row">
                    <div class="op-info">
                        <span class="op-title">${h.title}</span>
                        <span class="op-date">${h.date || '–°–µ–≥–æ–¥–Ω—è'}</span>
                    </div>
                    <div class="op-amount ${h.sum > 0 ? 'amount-plus' : 'amount-minus'}">
                        ${h.sum > 0 ? '+' : ''}${h.sum.toLocaleString()} ‚ÇΩ
                    </div>
                </div>
            `).join('');
        }

        function topUpBalance() {
            const sum = prompt("–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª:");
            if(sum && !isNaN(sum)) {
                db.ref(`clients/${currentUser.fbKey}`).update({ balance: currentUser.balance + parseInt(sum) });
                db.ref(`clients/${currentUser.fbKey}/history`).push({ 
                    title: "–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ ATM", 
                    sum: parseInt(sum), 
                    date: new Date().toLocaleDateString() 
                });
            }
        }

        function openExchange() {
            const usd = prompt("–ö—É—Ä—Å: 1$ = 91.20 ‚ÇΩ\n–°–∫–æ–ª—å–∫–æ USD –∂–µ–ª–∞–µ—Ç–µ –∫—É–ø–∏—Ç—å?");
            if(!usd || isNaN(usd)) return;
            const cost = Math.round(usd * 91.2);

            if(currentUser.balance < cost) return alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä—É–±–ª–µ–π");

            db.ref(`clients/${currentUser.fbKey}`).update({ 
                balance: currentUser.balance - cost,
                usd: (currentUser.usd || 0) + parseFloat(usd)
            });
            db.ref(`clients/${currentUser.fbKey}/history`).push({ 
                title: "–ü–æ–∫—É–ø–∫–∞ –≤–∞–ª—é—Ç—ã", 
                sum: -cost, 
                date: new Date().toLocaleDateString() 
            });
            alert("–í–∞–ª—é—Ç–∞ –∑–∞—á–∏—Å–ª–µ–Ω–∞!");
        }

        function toggleFreeze() {
            alert("–ö–∞—Ä—Ç–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ –≤ —Ü–µ–ª—è—Ö –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –±–∞–Ω–∫.");
        }

        // –°—Ç–∞—Ä—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        initApp();

    </script>
</body>
</html>
