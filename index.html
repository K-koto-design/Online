<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–û–Ω–ª–∞–π–Ω</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <style>
        /* -----------------------------------------------------------
           1. –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ù–ê–°–¢–†–û–ô–ö–ò (ROOT)
           ----------------------------------------------------------- */
        :root {
            --bg-body: #f8f9fb;
            /* –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –≥–ª—É–±–æ–∫–∏–π –≥—Ä–∞–¥–∏–µ–Ω—Ç */
            --grad-red: linear-gradient(170deg, #000000 0%, #1a0000 40%, #660000 100%);
            
            --white: #ffffff;
            --sber-green: #2ecc71;
            --danger: #ff3b30;
            --frozen-overlay: rgba(179, 229, 252, 0.35); /* –¶–≤–µ—Ç –ª—å–¥–∞ */
            
            --text-dark: #1c1c1e;
            --text-grey: #8e8e93;
            
            --shadow-soft: 0 10px 30px rgba(0,0,0,0.05);
            --shadow-card: 0 15px 35px rgba(0,0,0,0.3);
            
            --radius-card: 28px;
            --radius-btn: 22px;
            
            /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∞ —ç–∫—Ä–∞–Ω–æ–≤ */
            --anim-screen: 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            overflow: hidden; background: var(--bg-body); 
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, sans-serif;
            -webkit-font-smoothing: antialiased;
            -webkit-user-select: none; /* –ó–∞—â–∏—Ç–∞ –æ—Ç –≤—ã–¥–µ–ª–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ */
            user-select: none;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }

        /* -----------------------------------------------------------
           2. –°–ò–°–¢–ï–ú–ê –≠–ö–†–ê–ù–û–í (SPA)
           ----------------------------------------------------------- */
        .screen { 
            display: none; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            width: 100%; height: 100%; overflow-y: auto; background: var(--bg-body);
            z-index: 10; opacity: 0; transform: scale(0.96);
            transition: opacity var(--anim-screen), transform var(--anim-screen);
            will-change: transform, opacity;
        }
        .screen.active { display: block !important; opacity: 1; transform: scale(1); }

        /* -----------------------------------------------------------
           3. –≠–ö–†–ê–ù –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò
           ----------------------------------------------------------- */
        .auth-wrap { 
            padding: 80px 30px 40px; text-align: center; 
            display: flex; flex-direction: column; min-height: 100vh; 
            background: var(--white);
        }
        .logo-text { 
            font-size: 52px; font-weight: 900; 
            background: linear-gradient(45deg, #000, #b30000); 
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; 
            margin: 0; letter-spacing: -3px; 
        }
        
        .client-list { 
            background: #fff; border-radius: 30px; margin: 40px 0; padding: 10px; 
            flex-grow: 1; box-shadow: inset 0 0 20px rgba(0,0,0,0.03); 
            overflow-y: auto; border: 1px solid #eee;
        }
        .user-row { 
            padding: 22px; border-radius: 20px; margin-bottom: 8px; 
            font-weight: 700; font-size: 18px; color: #333;
            display: flex; justify-content: space-between; align-items: center; 
            transition: 0.2s; cursor: pointer; background: #fff;
            box-shadow: 0 2px 10px rgba(0,0,0,0.03);
        }
        .user-row:active { transform: scale(0.98); background: #f5f5f5; }
        .user-row.selected { 
            background: #fff0f0; border: 2px solid #b30000; color: #b30000; 
        }

        /* -----------------------------------------------------------
           4. –≠–ö–†–ê–ù –í–í–û–î–ê –ü–ò–ù-–ö–û–î–ê
           ----------------------------------------------------------- */
        #screen-pin-entry { 
            background: linear-gradient(135deg, #000 0%, #3a0000 100%); 
            color: white; display: none; flex-direction: column; 
            align-items: center; justify-content: space-between; 
            padding: 80px 30px 50px; 
        }
        .pin-dots { display: flex; gap: 24px; margin: 50px 0; }
        .p-dot { 
            width: 16px; height: 16px; border: 2px solid rgba(255,255,255,0.3); 
            border-radius: 50%; transition: 0.2s; 
        }
        .p-dot.active { 
            background: #ff3b30; border-color: #ff3b30; 
            box-shadow: 0 0 20px #ff3b30; transform: scale(1.3); 
        }

        .keypad { 
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; 
            width: 100%; max-width: 320px; 
        }
        .k-btn { 
            height: 75px; border-radius: 50%; background: rgba(255,255,255,0.1); 
            display: flex; align-items: center; justify-content: center; 
            font-size: 30px; font-weight: 500; cursor: pointer; 
            backdrop-filter: blur(5px); transition: 0.1s;
        }
        .k-btn:active { background: rgba(255,255,255,0.3); transform: scale(0.95); }

        /* -----------------------------------------------------------
           5. –ì–õ–ê–í–ù–´–ô –≠–ö–†–ê–ù (DASHBOARD)
           ----------------------------------------------------------- */
        .header-top { 
            background: var(--grad-red); 
            padding: 60px 0 45px; 
            border-radius: 0 0 50px 50px; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.4); 
            color: white; position: relative; z-index: 5;
        }
        .user-meta { 
            display: flex; justify-content: space-between; padding: 0 30px; 
            align-items: center; margin-bottom: 30px; 
        }
        .ava-box { 
            width: 50px; height: 50px; background: rgba(255,255,255,0.2); 
            border-radius: 50%; display: flex; align-items: center; 
            justify-content: center; font-weight: 800; font-size: 20px;
            backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1);
        }

        /* –ö–ê–†–†–£–°–ï–õ–¨ –ö–ê–†–¢ */
        .cards-row { 
            display: flex; overflow-x: auto; padding: 10px 30px 40px; gap: 20px; 
            scroll-snap-type: x mandatory; scrollbar-width: none; 
            -webkit-overflow-scrolling: touch; /* –ü–ª–∞–≤–Ω—ã–π —Å–∫—Ä–æ–ª–ª iOS */
        }
        .cards-row::-webkit-scrollbar { display: none; }

        /* –°–¢–ò–õ–¨ –í–ï–†–¢–ò–ö–ê–õ–¨–ù–û–ô –ö–ê–†–¢–´ */
        .v-card { 
            min-width: 175px; height: 260px; border-radius: var(--radius-card); 
            padding: 25px; display: flex; flex-direction: column; 
            justify-content: space-between; scroll-snap-align: center; 
            box-shadow: var(--shadow-card); position: relative; overflow: hidden; 
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); 
            border: 1px solid rgba(255,255,255,0.15);
            cursor: pointer;
            z-index: 10; /* –ü–æ–¥–Ω–∏–º–∞–µ–º –∫–∞—Ä—Ç—É –≤—ã—à–µ */
            touch-action: manipulation; /* –£–ª—É—á—à–∞–µ—Ç —Ä–µ–∞–∫—Ü–∏—é –Ω–∞ —Ç–∞—á */
        }
        .v-card:active { transform: scale(0.96); }
        
        /* –°—Ç–∏–ª–∏ –∑–∞–ª–∏–≤–∫–∏ –∫–∞—Ä—Ç */
        .c-black { background: linear-gradient(160deg, #2b2b2b 0%, #000000 100%); }
        .c-blue { background: linear-gradient(160deg, #1e3c72 0%, #2a5298 100%); }
        .c-gold { background: linear-gradient(160deg, #d4af37 0%, #f1c40f 100%); color: #4a3b00; text-shadow:none; }

        /* –≠—Ñ—Ñ–µ–∫—Ç –ó–ê–ú–û–†–û–ó–ö–ò (–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ) */
        .v-card.frozen { 
            filter: blur(0px); /* –£–±—Ä–∞–ª–∏ —Å–∏–ª—å–Ω—ã–π –±–ª—é—Ä —Å–∞–º–æ–π –∫–∞—Ä—Ç—ã –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏, –¥–æ–±–∞–≤–∏–º –æ–≤–µ—Ä–ª–µ–π */
        }
        .v-card.frozen::before {
            content: ""; position: absolute; top:0; left:0; right:0; bottom:0;
            backdrop-filter: blur(4px) grayscale(0.8);
            z-index: 1; pointer-events: none; /* –ü–†–û–ü–£–°–ö–ê–ï–¢ –ö–õ–ò–ö */
        }
        .v-card.frozen::after { 
            content: "‚ùÑÔ∏è FROZEN"; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: var(--frozen-overlay); color: white; 
            display: flex; align-items: center; justify-content: center; 
            font-weight: 900; font-size: 20px; letter-spacing: 2px;
            text-shadow: 0 2px 5px rgba(0,0,0,0.5);
            z-index: 2; 
            pointer-events: none; /* !!! –í–ê–ñ–ù–û: –ö–ª–∏–∫ –ø—Ä–æ—Ö–æ–¥–∏—Ç —Å–∫–≤–æ–∑—å –Ω–∞–¥–ø–∏—Å—å –∫ –∫–∞—Ä—Ç–µ */
        }

        .c-chip { 
            width: 38px; height: 28px; background: rgba(255,255,255,0.25); 
            border-radius: 8px; position: relative; z-index:0; 
        }
        .c-balance { font-size: 24px; font-weight: 900; margin-top: 15px; z-index:0; }
        .c-number { font-size: 11px; opacity: 0.6; letter-spacing: 2px; margin-top: auto; z-index:0; text-transform: uppercase; }

        /* –ö–Ω–æ–ø–∫–∏ –±—ã—Å—Ç—Ä—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π */
        .quick-actions { 
            display: flex; justify-content: center; gap: 25px; margin-top: 5px; 
        }
        .qa-btn { 
            width: 60px; height: 60px; background: rgba(255,255,255,0.1); 
            border-radius: 20px; display: flex; align-items: center; 
            justify-content: center; font-size: 26px; backdrop-filter: blur(10px); 
            cursor: pointer; transition: 0.2s; border: 1px solid rgba(255,255,255,0.05);
        }
        .qa-btn:active { background: rgba(255,255,255,0.25); transform: translateY(2px); }

        /* –ö–æ–Ω—Ç–µ–Ω—Ç –ø–æ–¥ —à–∞–ø–∫–æ–π */
        .white-content { padding: 35px 25px 100px; }
        .widget { 
            background: #fff; border-radius: 26px; padding: 22px; margin-bottom: 15px; 
            display: flex; align-items: center; gap: 18px; 
            box-shadow: var(--shadow-soft); cursor: pointer; transition: 0.2s;
        }
        .widget:active { transform: scale(0.98); background: #fcfcfc; }
        .w-ico { 
            width: 52px; height: 52px; border-radius: 16px; 
            display: flex; align-items: center; justify-content: center; font-size: 24px; 
        }

        /* -----------------------------------------------------------
           6. –§–û–†–ú–´ (–ü–ï–†–ï–í–û–î–´, –ö–†–ï–î–ò–¢–´)
           ----------------------------------------------------------- */
        .form-box { padding: 25px; }
        .form-card { 
            background: #fff; border-radius: 35px; padding: 35px; 
            box-shadow: var(--shadow-soft); 
        }
        
        label { 
            display: block; font-size: 13px; font-weight: 800; color: #bbb; 
            margin-bottom: 8px; margin-left: 10px; text-transform: uppercase; 
        }
        input, select { 
            width: 100%; height: 60px; border-radius: 20px; border: 1px solid #e0e0e0; 
            padding: 0 20px; margin-bottom: 25px; font-size: 18px; 
            background: #fafafa; transition: 0.3s; color: #000;
        }
        input:focus { border-color: #000; background: #fff; }

        .btn-main { 
            width: 100%; height: 65px; border: none; border-radius: var(--radius-btn); 
            font-size: 18px; font-weight: 800; cursor: pointer; transition: 0.2s; 
        }
        .btn-black { background: #000; color: #fff; box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
        .btn-black:active { opacity: 0.8; transform: scale(0.98); }
        
        .btn-red { background: var(--danger); color: #fff; margin-top: 15px; }
        .btn-red:active { opacity: 0.8; }
        
        .back-btn { 
            width: 45px; height: 45px; border-radius: 50%; background: #f0f0f0; 
            display: flex; align-items: center; justify-content: center; 
            cursor: pointer; margin-bottom: 20px; font-size: 20px; color: #333;
        }

        /* -----------------------------------------------------------
           7. –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê –ò –î–ï–¢–ê–õ–ò
           ----------------------------------------------------------- */
        .modal { 
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.85); z-index: 9999; align-items: center; 
            justify-content: center; backdrop-filter: blur(15px); 
        }
        .modal-in { 
            background: #fff; width: 85%; max-width: 380px; border-radius: 40px; 
            padding: 40px; text-align: center; 
        }

        /* –≠–∫—Ä–∞–Ω –¥–µ—Ç–∞–ª–µ–π */
        .details-top { 
            background: #fff; padding: 70px 30px 40px; border-radius: 0 0 50px 50px; 
            text-align: center; box-shadow: var(--shadow-soft); position: relative;
        }
        .hist-item { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 20px 15px; border-bottom: 1px solid #f8f8f8; 
        }
        
        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∑–∞–º–æ—Ä–æ–∑–∫–µ –≤–Ω—É—Ç—Ä–∏ –¥–µ—Ç–∞–ª–µ–π */
        #frozen-alert {
            display: none; background: #e3f2fd; color: #1565c0; 
            padding: 15px; border-radius: 18px; margin: 20px 0; 
            font-size: 14px; font-weight: 700; border: 1px solid #bbdefb;
        }
    </style>
</head>
<body>

    <div id="modal-success" class="modal">
        <div class="modal-in">
            <div style="width:90px; height:90px; background:#2ecc71; color:white; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:50px; margin:0 auto 25px;">‚úì</div>
            <h2 id="suc-h" style="margin:0;">–£—Å–ø–µ—à–Ω–æ</h2>
            <div id="suc-val" style="font-size:36px; font-weight:900; margin:15px 0;">0 ‚ÇΩ</div>
            <p id="suc-p" style="color:#aaa; margin-bottom:30px;"></p>
            <button class="btn-main btn-red" onclick="view.hideSuccess()">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <div id="screen-auth" class="screen active">
        <div class="auth-wrap">
            <h1 class="logo-text">K-Online</h1>
            <p style="color:#999; font-weight:600; margin-top:5px;">Red Onyx Edition</p>
            
            <div class="client-list" id="ui-clients">
                <div style="padding:40px; color:#ccc;">–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –±–∞–Ω–∫–æ–º...</div>
            </div>
            
            <div style="display:flex; gap:12px;">
                <button class="btn-main" style="background:#f2f2f2; color:#000; flex:1;" onclick="logic.reg()">+ –°–æ–∑–¥–∞—Ç—å</button>
                <button class="btn-main" style="width:90px; background:linear-gradient(45deg,#000,#600); color:white;" onclick="logic.goPin()">‚ûú</button>
            </div>
        </div>
    </div>

    <div id="screen-pin-entry" class="screen">
        <div style="text-align:center;">
            <h2 id="pin-user" style="font-size:36px; font-weight:900; margin:0;">–í—Ö–æ–¥</h2>
            <p style="opacity:0.6; margin-top:10px;">–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –¥–æ—Å—Ç—É–ø–∞</p>
        </div>
        
        <div class="pin-dots">
            <div class="p-dot"></div><div class="p-dot"></div><div class="p-dot"></div><div class="p-dot"></div>
        </div>
        
        <div class="keypad">
            <div class="k-btn" onclick="logic.tapPin('1')">1</div><div class="k-btn" onclick="logic.tapPin('2')">2</div><div class="k-btn" onclick="logic.tapPin('3')">3</div>
            <div class="k-btn" onclick="logic.tapPin('4')">4</div><div class="k-btn" onclick="logic.tapPin('5')">5</div><div class="k-btn" onclick="logic.tapPin('6')">6</div>
            <div class="k-btn" onclick="logic.tapPin('7')">7</div><div class="k-btn" onclick="logic.tapPin('8')">8</div><div class="k-btn" onclick="logic.tapPin('9')">9</div>
            <div class="k-btn" style="opacity:0; pointer-events:none;"></div><div class="k-btn" onclick="logic.tapPin('0')">0</div><div class="k-btn" onclick="logic.tapPin('DEL')">‚å´</div>
        </div>
        <div onclick="view.nav('screen-auth')" style="opacity:0.6; text-decoration:underline; margin-top:30px; cursor:pointer;">–°–º–µ–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</div>
    </div>

    <div id="screen-home" class="screen">
        <div class="header-top">
            <div class="user-meta">
                <div>
                    <div id="h-name" style="font-size:26px; font-weight:900;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    <div style="font-size:13px; opacity:0.7; margin-top:5px;">Premium Client</div>
                </div>
                <div id="h-ava" class="ava-box">?</div>
            </div>
            
            <div class="cards-row" id="h-cards">
                </div>

            <div class="quick-actions">
                <div class="qa-btn" onclick="view.nav('screen-transfer')">üí∏</div>
                <div class="qa-btn" onclick="view.nav('screen-exchange')">üîÑ</div>
                <div class="qa-btn" onclick="view.nav('screen-loan')">üè¶</div>
                <div class="qa-btn" onclick="alert('–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –∫–∞–∂–¥–æ–π –∫–∞—Ä—Ç—ã.')">üßæ</div>
            </div>
        </div>

        <div class="white-content">
            <h3 style="margin-left:10px; margin-bottom:20px; color:#333;">–í–∞—à–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏</h3>
            
            <div class="widget" onclick="view.nav('screen-transfer')">
                <div class="w-ico" style="background:#e8f5e9; color:#2ecc71;">‚ö°</div>
                <div style="flex:1;">
                    <b style="font-size:17px;">–ü–µ—Ä–µ–≤–æ–¥ –∫–ª–∏–µ–Ω—Ç—É</b>
                    <div style="font-size:13px; color:#999;">–ú–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ –∏ –±–µ–∑ –∫–æ–º–∏—Å—Å–∏–∏</div>
                </div>
            </div>

            <div class="widget" onclick="view.nav('screen-exchange')">
                <div class="w-ico" style="background:#e3f2fd; color:#3498db;">üí≤</div>
                <div style="flex:1;">
                    <b style="font-size:17px;">–ü–æ–∫—É–ø–∫–∞ –≤–∞–ª—é—Ç—ã</b>
                    <div id="w-usd" style="font-size:14px; font-weight:700; color:#444;">...</div>
                </div>
            </div>

            <div id="w-loan-box" class="widget" onclick="view.nav('screen-loan')">
                <div class="w-ico" style="background:#fff3e0; color:#f39c12;">üî•</div>
                <div style="flex:1;">
                    <b style="font-size:17px;">–ö—Ä–µ–¥–∏—Ç–Ω–∞—è –∫–∞—Ä—Ç–∞</b>
                    <div style="font-size:13px; color:#e67e22;">–í–∞–º –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –æ–¥–æ–±—Ä–µ–Ω–æ</div>
                </div>
            </div>
        </div>
    </div>

    <div id="screen-transfer" class="screen">
        <div class="form-box">
            <div class="back-btn" onclick="view.nav('screen-home')">‚Üê</div>
            <h2 style="font-size:36px; font-weight:900; margin-bottom:10px;">–ü–µ—Ä–µ–≤–æ–¥</h2>
            <p style="color:#888; margin-bottom:30px;">–û—Ç–ø—Ä–∞–≤–∫–∞ —Å—Ä–µ–¥—Å—Ç–≤ –¥—Ä—É–≥–æ–º—É –∫–ª–∏–µ–Ω—Ç—É</p>
            
            <div class="form-card">
                <label>–ü–æ–ª—É—á–∞—Ç–µ–ª—å</label>
                <select id="tr-target"></select>
                
                <label>–°—É–º–º–∞ (‚ÇΩ)</label>
                <input type="number" id="tr-val" placeholder="0">
                
                <button class="btn-main btn-black" onclick="bank.send()">–ü–µ—Ä–µ–≤–µ—Å—Ç–∏</button>
                <button class="btn-main btn-red" onclick="view.nav('screen-home')">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <div id="screen-exchange" class="screen">
        <div class="form-box">
            <div class="back-btn" onclick="view.nav('screen-home')">‚Üê</div>
            <h2 style="font-size:36px; font-weight:900; margin-bottom:30px;">–û–±–º–µ–Ω –≤–∞–ª—é—Ç</h2>
            <div class="form-card" style="text-align:center;">
                <p style="color:#aaa;">–¢–µ–∫—É—â–∏–π –∫—É—Ä—Å</p>
                <div style="font-size:50px; font-weight:900; margin:10px 0;">91.20 ‚ÇΩ</div>
                
                <label style="text-align:left;">–ö—É–ø–∏—Ç—å USD ($)</label>
                <input type="number" id="ex-val" placeholder="100">
                
                <button class="btn-main btn-black" style="background:#3498db;" onclick="bank.exchange()">–ö—É–ø–∏—Ç—å</button>
                <button class="btn-main btn-red" onclick="view.nav('screen-home')">–ù–∞–∑–∞–¥</button>
            </div>
        </div>
    </div>

    <div id="screen-loan" class="screen">
        <div class="form-box">
            <div class="back-btn" onclick="view.nav('screen-home')">‚Üê</div>
            <h2 style="font-size:36px; font-weight:900; margin-bottom:30px;">–ö—Ä–µ–¥–∏—Ç</h2>
            <div class="form-card">
                <label>–õ–∏–º–∏—Ç (‚ÇΩ)</label>
                <input type="number" id="ln-val" placeholder="–ú–∏–Ω. 10 000">
                
                <div style="background:#fff3e0; padding:15px; border-radius:15px; color:#e67e22; font-size:13px; margin-bottom:20px;">
                    <b>–ö–∞—Ä—Ç–∞ GOLD</b> –±—É–¥–µ—Ç –≤—ã–ø—É—â–µ–Ω–∞ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ. –õ—å–≥–æ—Ç–Ω—ã–π –ø–µ—Ä–∏–æ–¥ 100 –¥–Ω–µ–π.
                </div>
                
                <button class="btn-main btn-black" style="background:#f39c12;" onclick="bank.loan()">–û—Ñ–æ—Ä–º–∏—Ç—å –∫–∞—Ä—Ç—É</button>
                <button class="btn-main btn-red" onclick="view.nav('screen-home')">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <div id="screen-details" class="screen">
        <div class="details-top">
            <div class="back-btn" onclick="view.nav('screen-home')" style="margin:0 auto 20px;">‚úï</div>
            
            <div id="d-label" style="text-transform:uppercase; font-size:12px; font-weight:900; color:#bbb; letter-spacing:2px;">–°—á–µ—Ç</div>
            <h1 id="d-sum" style="font-size:50px; font-weight:900; margin:10px 0;">0</h1>
            
            <div id="frozen-alert">‚ö†Ô∏è –ö–ê–†–¢–ê –ó–ê–ú–û–†–û–ñ–ï–ù–ê. –û–ü–ï–†–ê–¶–ò–ò –ù–ï–î–û–°–¢–£–ü–ù–´.</div>
            
            <div id="d-action-box" style="margin-top:25px;"></div>
        </div>
        
        <div style="padding:30px 20px;">
            <h3 style="margin-left:15px;">–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</h3>
            <div id="d-hist"></div>
            <button class="btn-main btn-red" style="margin-top:40px; background:#eee; color:#000;" onclick="view.nav('screen-home')">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <script>
        /**
         * -------------------------------------------------------------
         * CORE SYSTEM
         * -------------------------------------------------------------
         */
        
        const config = { 
            apiKey: "AIzaSyA3J7KnUgxUHZigwRKmndm7xyxJeeLCrxg", 
            databaseURL: "https://webapp-b7149-default-rtdb.europe-west1.firebasedatabase.app", 
            projectId: "webapp-b7149" 
        };
        firebase.initializeApp(config);
        const rtdb = firebase.database();

        const state = {
            all: [],
            selKey: null,
            user: null,
            pin: "",
            busy: false
        };

        const view = {
            nav: (id) => {
                // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —ç–∫—Ä–∞–Ω—ã
                document.querySelectorAll('.screen').forEach(s => {
                    s.classList.remove('active');
                    // –î–∞–µ–º –≤—Ä–µ–º—è –∞–Ω–∏–º–∞—Ü–∏–∏ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è
                    setTimeout(() => { if(!s.classList.contains('active')) s.style.display='none'; }, 400);
                });
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–π
                const t = document.getElementById(id);
                t.style.display = (id === 'screen-pin-entry') ? 'flex' : 'block';
                
                // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–æ—è–≤–ª–µ–Ω–∏—è (transition)
                setTimeout(() => {
                    t.classList.add('active');
                    window.scrollTo(0,0);
                }, 50);
            },
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            drawClients: () => {
                const box = document.getElementById('ui-clients');
                if(!state.all.length) { box.innerHTML = '<div style="padding:40px">–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç</div>'; return; }
                
                box.innerHTML = state.all.map(u => `
                    <div class="user-row ${state.selKey === u.fbKey ? 'selected' : ''}" onclick="logic.pick('${u.fbKey}')">
                        <div>${u.name}</div>
                        ${state.selKey === u.fbKey ? '<div style="color:#b30000; font-weight:900;">‚úî</div>' : ''}
                    </div>
                `).join('');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤
                const sel = document.getElementById('tr-target');
                if(sel) {
                    sel.innerHTML = state.all
                        .filter(u => u.fbKey !== state.user?.fbKey)
                        .map(u => `<option value="${u.fbKey}">${u.name}</option>`).join('');
                }
            },

            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –ì–ª–∞–≤–Ω–æ–≥–æ –≠–∫—Ä–∞–Ω–∞
            drawDash: () => {
                const u = state.user;
                if(!u) return; // –ó–∞—â–∏—Ç–∞ –æ—Ç –æ—à–∏–±–æ–∫

                document.getElementById('h-name').innerText = u.name;
                document.getElementById('h-ava').innerText = u.name[0];
                document.getElementById('w-usd').innerText = (u.usd || 0).toFixed(2) + " $";

                const container = document.getElementById('h-cards');
                let cardsHtml = '';

                // 1. –†—É–±–ª–µ–≤–∞—è –∫–∞—Ä—Ç–∞ (–ï—Å—Ç—å –≤—Å–µ–≥–¥–∞)
                cardsHtml += `
                    <div class="v-card c-black ${u.isFrozen ? 'frozen' : ''}" onclick="view.openDet('rub')">
                        <div style="display:flex; justify-content:space-between;">
                            <div class="c-chip"></div>
                            <div style="font-weight:900; font-style:italic;">MIR</div>
                        </div>
                        <div>
                            <div class="c-balance">${(u.balance || 0).toLocaleString()} ‚ÇΩ</div>
                            <div class="c-number">DEBIT ‚Ä¢ 4410</div>
                        </div>
                    </div>
                `;

                // 2. –î–æ–ª–ª–∞—Ä–æ–≤–∞—è –∫–∞—Ä—Ç–∞ (–ï—Å–ª–∏ –µ—Å—Ç—å –±–∞–ª–∞–Ω—Å)
                if(u.usd > 0) {
                    cardsHtml += `
                        <div class="v-card c-blue ${u.isFrozenUsd ? 'frozen' : ''}" onclick="view.openDet('usd')">
                            <div style="display:flex; justify-content:space-between;">
                                <div class="c-chip"></div>
                                <div style="font-weight:900; font-style:italic;">VISA</div>
                            </div>
                            <div>
                                <div class="c-balance">${u.usd.toFixed(2)} $</div>
                                <div class="c-number">DIGITAL ‚Ä¢ 8821</div>
                            </div>
                        </div>
                    `;
                }

                // 3. –ö—Ä–µ–¥–∏—Ç–Ω–∞—è –∫–∞—Ä—Ç–∞ (–ï—Å–ª–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∞)
                if(u.hasCredit) {
                    document.getElementById('w-loan-box').style.display = 'none';
                    cardsHtml += `
                        <div class="v-card c-gold ${u.isFrozenGold ? 'frozen' : ''}" onclick="view.openDet('gold')">
                            <div style="display:flex; justify-content:space-between;">
                                <div class="c-chip" style="background:rgba(0,0,0,0.1)"></div>
                                <div style="font-weight:900; font-style:italic;">GOLD</div>
                            </div>
                            <div>
                                <div class="c-balance">${(u.creditBalance || 0).toLocaleString()} ‚ÇΩ</div>
                                <div class="c-number">CREDIT ‚Ä¢ 7700</div>
                            </div>
                        </div>
                    `;
                } else {
                    document.getElementById('w-loan-box').style.display = 'flex';
                }

                container.innerHTML = cardsHtml;
            },

            // –û—Ç–∫—Ä—ã—Ç–∏–µ –¥–µ—Ç–∞–ª–µ–π –∫–∞—Ä—Ç—ã
            openDet: (type) => {
                const u = state.user;
                if(!u) return;

                const lab = document.getElementById('d-label');
                const sum = document.getElementById('d-sum');
                const act = document.getElementById('d-action-box');
                const alertBox = document.getElementById('frozen-alert');
                
                // –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ (Bugfix)
                let hist = u.history ? Object.values(u.history).reverse() : [];
                let isFrozen = false;

                if(type === 'rub') {
                    lab.innerText = "MIR PREMIUM";
                    sum.innerText = (u.balance || 0).toLocaleString() + " ‚ÇΩ";
                    sum.style.color = "#000";
                    isFrozen = u.isFrozen;
                    
                    act.innerHTML = `
                        <button class="btn-main btn-black" onclick="bank.toggleFreeze('isFrozen', ${!isFrozen})">
                            ${isFrozen ? '–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç—É' : '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç—É'}
                        </button>
                    `;
                } 
                else if(type === 'usd') {
                    lab.innerText = "VISA DIGITAL USD";
                    sum.innerText = (u.usd || 0).toFixed(2) + " $";
                    sum.style.color = "#2a5298";
                    isFrozen = u.isFrozenUsd;
                    
                    act.innerHTML = `
                        <button class="btn-main btn-black" onclick="bank.toggleFreeze('isFrozenUsd', ${!isFrozen})">
                            ${isFrozen ? '–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç—É' : '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç—É'}
                        </button>
                    `;
                } 
                else if(type === 'gold') {
                    lab.innerText = "GOLD CREDIT LIMIT";
                    sum.innerText = (u.creditBalance || 0).toLocaleString() + " ‚ÇΩ";
                    sum.style.color = "#f1c40f";
                    isFrozen = u.isFrozenGold;
                    
                    const debt = (u.creditLimit || 0) - (u.creditBalance || 0);
                    
                    act.innerHTML = `
                        ${debt > 0 ? `<button class="btn-main btn-black" onclick="bank.repay(${debt})" style="margin-bottom:10px">–ü–æ–≥–∞—Å–∏—Ç—å –¥–æ–ª–≥ (${debt} ‚ÇΩ)</button>` : ''}
                        <button class="btn-main btn-red" onclick="bank.toggleFreeze('isFrozenGold', ${!isFrozen})">
                            ${isFrozen ? '–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å' : '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å'}
                        </button>
                    `;
                }

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–ª–∞—à–∫—É –µ—Å–ª–∏ –∑–∞–º–æ—Ä–æ–∂–µ–Ω–æ
                alertBox.style.display = isFrozen ? 'block' : 'none';
                
                // –†–µ–Ω–¥–µ—Ä –∏—Å—Ç–æ—Ä–∏–∏
                const histCont = document.getElementById('d-hist');
                histCont.innerHTML = hist.length ? hist.map(h => `
                    <div class="hist-item">
                        <div>
                            <div style="font-weight:700;">${h.title}</div>
                            <div style="font-size:12px; color:#aaa;">${new Date(h.date).toLocaleDateString()}</div>
                        </div>
                        <div style="font-weight:800; color:${h.sum > 0 ? '#2ecc71' : '#000'}">
                            ${h.sum > 0 ? '+' : ''}${h.sum.toLocaleString()}
                        </div>
                    </div>
                `).join('') : '<div style="text-align:center; padding:20px; color:#ccc;">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</div>';

                view.nav('screen-details');
            },

            showSuccess: (h, v, p) => {
                document.getElementById('suc-h').innerText = h;
                document.getElementById('suc-val').innerText = v;
                document.getElementById('suc-p').innerText = p;
                document.getElementById('modal-success').style.display = 'flex';
            },
            hideSuccess: () => {
                document.getElementById('modal-success').style.display = 'none';
                view.nav('screen-home');
            }
        };

        const logic = {
            init: () => {
                rtdb.ref('clients').on('value', s => {
                    const d = s.val();
                    state.all = d ? Object.keys(d).map(k => ({...d[k], fbKey: k})) : [];
                    view.drawClients();
                    
                    // –ï—Å–ª–∏ –º—ã —É–∂–µ –≤–Ω—É—Ç—Ä–∏ –∞–∫–∫–∞—É–Ω—Ç–∞, –æ–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
                    if(state.user) {
                        const freshData = state.all.find(x => x.fbKey === state.user.fbKey);
                        if(freshData) {
                            state.user = freshData;
                            view.drawDash();
                        }
                    }
                });
            },
            
            pick: (k) => { state.selKey = k; view.drawClients(); },
            
            goPin: () => {
                if(!state.selKey) return alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Å–ø–∏—Å–∫–∞.");
                const u = state.all.find(x => x.fbKey === state.selKey);
                document.getElementById('pin-user').innerText = u.name.split(' ')[0];
                state.pin = "";
                logic.updPinUI();
                view.nav('screen-pin-entry');
            },
            
            tapPin: (v) => {
                if(state.busy) return;
                
                if(v === 'DEL') state.pin = state.pin.slice(0, -1);
                else if(state.pin.length < 4) state.pin += v;
                
                logic.updPinUI();

                if(state.pin.length === 4) {
                    state.busy = true;
                    // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–≤–æ–¥–∞
                    setTimeout(() => {
                        const u = state.all.find(x => x.fbKey === state.selKey);
                        if(u.clientPin === state.pin) {
                            state.user = u; // –õ–æ–≥–∏–Ω —É—Å–ø–µ—à–µ–Ω
                            view.drawDash();
                            view.nav('screen-home');
                            state.pin = "";
                        } else {
                            alert("–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥ –¥–æ—Å—Ç—É–ø–∞");
                            state.pin = "";
                            logic.updPinUI();
                        }
                        state.busy = false;
                    }, 250);
                }
            },
            
            updPinUI: () => {
                document.querySelectorAll('.p-dot').forEach((d, i) => {
                    d.classList.toggle('active', i < state.pin.length);
                });
            },
            
            // [FIX] –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ò–°–¢–û–†–ò–ï–ô
            reg: () => {
                const n = prompt("–í–≤–µ–¥–∏—Ç–µ –ò–º—è –§–∞–º–∏–ª–∏—é:");
                const p = prompt("–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ü–ò–ù (4 —Ü–∏—Ñ—Ä—ã):");
                
                if(n && p && p.length === 4) {
                    rtdb.ref('clients').push({
                        name: n, 
                        clientPin: p, 
                        balance: 50000, 
                        usd: 0, 
                        hasCredit: false,
                        // –°—Ç–∞—Ç—É—Å—ã –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
                        isFrozen: false,
                        isFrozenUsd: false,
                        isFrozenGold: false,
                        // [FIX] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏—Å—Ç–æ—Ä–∏–∏, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–∞—Ä—Ç—É
                        history: {
                            init: {
                                title: "–û—Ç–∫—Ä—ã—Ç–∏–µ —Å—á–µ—Ç–∞",
                                sum: 50000,
                                date: Date.now()
                            }
                        }
                    });
                } else {
                    if(n) alert("–û—à–∏–±–∫–∞. –ü–ò–ù –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∏–∑ 4 —Ü–∏—Ñ—Ä.");
                }
            }
        };

        const bank = {
            send: () => {
                if(state.user.isFrozen) return alert("–û–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞: –í–∞—à–∞ –∫–∞—Ä—Ç–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞.");
                
                const to = document.getElementById('tr-target').value;
                const val = parseInt(document.getElementById('tr-val').value);
                const u = state.user;
                const target = state.all.find(x => x.fbKey === to);

                if(!val || val <= 0) return alert("–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É");
                if(u.balance < val) return alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤");

                // –°–ø–∏—Å–∞–Ω–∏–µ
                rtdb.ref(`clients/${u.fbKey}`).update({ balance: u.balance - val });
                rtdb.ref(`clients/${u.fbKey}/history`).push({ 
                    title: `–ü–µ—Ä–µ–≤–æ–¥ (${target.name})`, sum: -val, date: Date.now() 
                });
                
                // –ó–∞—á–∏—Å–ª–µ–Ω–∏–µ
                rtdb.ref(`clients/${to}`).update({ balance: (target.balance||0) + val });
                rtdb.ref(`clients/${to}/history`).push({ 
                    title: `–í—Ö–æ–¥—è—â–∏–π (${u.name})`, sum: val, date: Date.now() 
                });

                view.showSuccess("–ü–µ—Ä–µ–≤–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω", val+" ‚ÇΩ", "–ü–æ–ª—É—á–∞—Ç–µ–ª—å: "+target.name);
                document.getElementById('tr-val').value = "";
            },
            
            exchange: () => {
                if(state.user.isFrozen) return alert("–û–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞: –†—É–±–ª–µ–≤—ã–π —Å—á–µ—Ç –∑–∞–º–æ—Ä–æ–∂–µ–Ω.");
                
                const amt = parseFloat(document.getElementById('ex-val').value);
                const rate = 91.20;
                const cost = Math.round(amt * rate);
                const u = state.user;

                if(!amt || amt <= 0) return alert("–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É");
                if(u.balance < cost) return alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä—É–±–ª–µ–π");

                rtdb.ref(`clients/${u.fbKey}`).update({
                    balance: u.balance - cost,
                    usd: (u.usd || 0) + amt,
                    isFrozenUsd: false // –ü—Ä–∏ –ø–æ–∫—É–ø–∫–µ —Ä–∞–∑–º–æ—Ä–∞–∂–∏–≤–∞–µ–º, –µ—Å–ª–∏ –±—ã–ª–∞
                });
                rtdb.ref(`clients/${u.fbKey}/history`).push({ 
                    title: "–ü–æ–∫—É–ø–∫–∞ USD", sum: -cost, date: Date.now() 
                });

                view.showSuccess("–£—Å–ø–µ—à–Ω–æ", amt+" $", "–°–ø–∏—Å–∞–Ω–æ: "+cost+" ‚ÇΩ");
                document.getElementById('ex-val').value = "";
            },
            
            loan: () => {
                const s = parseInt(document.getElementById('ln-val').value);
                if(!s || s < 10000) return alert("–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ 10 000 ‚ÇΩ");
                
                rtdb.ref(`clients/${state.user.fbKey}`).update({ 
                    hasCredit: true, 
                    creditLimit: s, 
                    creditBalance: s,
                    isFrozenGold: false
                });
                rtdb.ref(`clients/${state.user.fbKey}/history`).push({ 
                    title: "–ö—Ä–µ–¥–∏—Ç –æ—Ñ–æ—Ä–º–ª–µ–Ω", sum: s, date: Date.now() 
                });
                
                view.showSuccess("–ö—Ä–µ–¥–∏—Ç –≤—ã–¥–∞–Ω", s+" ‚ÇΩ", "–ö–∞—Ä—Ç–∞ GOLD –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –∫–æ—à–µ–ª–µ–∫");
            },
            
            toggleFreeze: (field, status) => {
                const updates = {};
                updates[field] = status;
                rtdb.ref(`clients/${state.user.fbKey}`).update(updates);
                
                // –ù–µ–±–æ–ª—å—à–æ–π UI feedback
                alert(status ? "–ö–∞—Ä—Ç–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞." : "–ö–∞—Ä—Ç–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞.");
                view.nav('screen-home');
            },
            
            repay: (amount) => {
                if(state.user.balance < amount) return alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–º —Å—á–µ—Ç–µ.");
                
                rtdb.ref(`clients/${state.user.fbKey}`).update({
                    balance: state.user.balance - amount,
                    creditBalance: state.user.creditLimit
                });
                rtdb.ref(`clients/${state.user.fbKey}/history`).push({ 
                    title: "–ü–æ–≥–∞—à–µ–Ω–∏–µ –¥–æ–ª–≥–∞", sum: -amount, date: Date.now() 
                });
                
                alert("–ó–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–≥–∞—à–µ–Ω–∞!");
                view.nav('screen-home');
            }
        };

        // –ó–ê–ü–£–°–ö –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
        window.onload = () => {
            logic.init();
            view.nav('screen-auth');
        };
    </script>
</body>
</html>
