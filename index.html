<!DOCTYPE html> 
<html lang="ru"> 
<head> 
    <meta charset="UTF-8"> 
    <title>–û–Ω–ª–∞–π–Ω</title> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"> 
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script> 
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script> 
    <style> 
        :root { --bg: #f2f3f7; --accent: #007aff; --card: #ffffff; --text: #1c1c1e; --secondary: #8e8e93; --border: #e5e5ea; --tab-bg: #ffffff; } 
        body.dark { --bg: #000000; --card: #1c1c1e; --text: #ffffff; --secondary: #8e8e93; --border: #333; --tab-bg: #121212; } 
        * { box-sizing: border-box; font-family: -apple-system, sans-serif; } 
        body { margin: 0; background: var(--bg); color: var(--text); transition: 0.3s; padding-bottom: 80px; } 
        .screen { display: none; padding: 20px; min-height: 100vh; } 
        .screen.active { display: block; } 
        .card { background: var(--card); border-radius: 20px; padding: 15px; margin-bottom: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); } 
        .balance { font-size: 28px; font-weight: 700; } 
        .btn { width: 100%; padding: 14px; border-radius: 14px; border: none; font-weight: 600; cursor: pointer; margin-bottom: 10px; } 
        .primary { background: #ffdd2d; color: #000; } 
        .secondary { background: var(--bg); color: var(--accent); border: 1px solid var(--border); } 
        /* –ß–∞—Ç —Å—Ç–∏–ª–∏ */
        #chat-box { height: 300px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; padding: 10px; background: var(--bg); border-radius: 15px; margin-bottom: 10px; }
        .m { padding: 8px 12px; border-radius: 15px; max-width: 80%; font-size: 14px; }
        .m.user { align-self: flex-end; background: var(--accent); color: white; }
        .m.admin { align-self: flex-start; background: var(--border); color: var(--text); }
        /* –¢–∞–±—ã */
        .tab-bar { position: fixed; bottom: 0; width: 100%; height: 70px; background: var(--tab-bg); display: flex; justify-content: space-around; align-items: center; border-top: 1px solid var(--border); }
        .tab-item { display: flex; flex-direction: column; align-items: center; font-size: 11px; color: var(--secondary); }
        .tab-item.active { color: var(--accent); }
        input { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid var(--border); background: var(--card); color: var(--text); margin-bottom: 10px; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; align-items: center; justify-content: center; }
        .modal-content { background: var(--card); width: 90%; padding: 20px; border-radius: 20px; }
    </style>
</head>
<body onload="init()">

    <div id="screen-login" class="screen active">
        <h1>–í—Ö–æ–¥</h1>
        <input type="text" id="logInp" placeholder="–ò–º—è..." oninput="search()">
        <div id="users"></div>
    </div>

    <div id="screen-home" class="screen">
        <h2 id="uName"></h2>
        <div class="card" onclick="openModal('det')">
            <small>–õ–∏—á–Ω—ã–π —Å—á–µ—Ç</small>
            <div class="balance" id="uBal">0 ‚ÇΩ</div>
            <div style="color:var(--accent); text-align:right">–ü–æ–¥—Ä–æ–±–Ω–µ–µ ></div>
        </div>
        <div id="cred-box" style="display:none" class="card">
            <small>–ö—Ä–µ–¥–∏—Ç–Ω—ã–π –ª–∏–º–∏—Ç</small>
            <div class="balance" style="color:#34c759" id="uCred">0 ‚ÇΩ</div>
        </div>
        <button class="btn primary" onclick="alert('–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞')">–í–∑—è—Ç—å –∫—Ä–µ–¥–∏—Ç –∑–∞ 1 –º–∏–Ω—É—Ç—É</button>
        <button class="btn secondary" onclick="nav('screen-support')">üéß –ü–æ–¥–¥–µ—Ä–∂–∫–∞</button>
    </div>

    <div id="screen-support" class="screen">
        <h2>–ü–æ–¥–¥–µ—Ä–∂–∫–∞ 24/7</h2>
        <div class="card">
            <div id="chat-box"></div>
            <div style="display:flex; gap:5px">
                <input type="text" id="msgInp" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." style="margin:0">
                <button class="btn primary" style="width:60px; margin:0" onclick="sendMsg()">></button>
            </div>
        </div>
        <button class="btn secondary" onclick="nav('screen-home')">–ù–∞–∑–∞–¥</button>
    </div>

    <div id="screen-settings" class="screen">
        <h1>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h1>
        <button class="btn secondary" onclick="toggleTheme()">–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É</button>
        <button class="btn primary" onclick="location.reload()">–í—ã—Ö–æ–¥</button>
    </div>

    <div id="modal-det" class="modal"><div class="modal-content">
        <h3>–°—á–µ—Ç –ø–æ–¥—Ä–æ–±–Ω–æ</h3>
        <p>–ë–æ–Ω—É—Å—ã: <b id="uBon">0</b></p>
        <button class="btn primary" onclick="alert('–°–∫–∞–Ω–µ—Ä QR –≥–æ—Ç–æ–≤')">–û–ø–ª–∞—Ç–∞ –ø–æ QR</button>
        <button class="btn secondary" onclick="closeModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div></div>

    <div class="tab-bar" id="menu" style="display:none">
        <div class="tab-item" onclick="nav('screen-home')">üè† –ì–ª–∞–≤–Ω–∞—è</div>
        <div class="tab-item" onclick="nav('screen-settings')">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
    </div>

    <script>
        const config = { 
            apiKey: "AIzaSyA3J7KnUgxUHZigwRKmndm7xyxJeeLCrxg", 
            databaseURL: "https://webapp-b7149-default-rtdb.europe-west1.firebasedatabase.app" 
        };
        firebase.initializeApp(config);
        const db = firebase.database();
        let users = [], cur = null;

        function init() {
            db.ref('clients').on('value', s => {
                const data = s.val();
                users = data ? Object.keys(data).map(k => ({...data[k], id: k})) : [];
                if(cur) { cur = users.find(u => u.id === cur.id); update(); }
            });
            if(localStorage.theme === 'dark') document.body.classList.add('dark');
        }

        function search() {
            const v = document.getElementById('logInp').value.toLowerCase();
            const box = document.getElementById('users'); box.innerHTML = "";
            if(v.length < 2) return;
            users.filter(u => u.name.toLowerCase().includes(v)).forEach(u => {
                const d = document.createElement('div'); d.className = 'card'; d.innerText = u.name;
                d.onclick = () => { cur = u; nav('screen-home'); };
                box.appendChild(d);
            });
        }

        function update() {
            document.getElementById('uName').innerText = cur.name;
            document.getElementById('uBal').innerText = (cur.balance || 0).toLocaleString() + ' ‚ÇΩ';
            document.getElementById('uBon').innerText = cur.bonuses || 0;
            if(cur.creditLimit > 0) {
                document.getElementById('cred-box').style.display = 'block';
                document.getElementById('uCred').innerText = cur.creditLimit.toLocaleString() + ' ‚ÇΩ';
            }
        }

        function sendMsg() {
            const t = document.getElementById('msgInp').value;
            if(!t) return;
            db.ref('chats/' + cur.id).push({ t, s: 'u', time: Date.now() });
            document.getElementById('msgInp').value = "";
        }

        function loadChat() {
            db.ref('chats/' + cur.id).on('value', s => {
                const box = document.getElementById('chat-box'); box.innerHTML = "";
                s.forEach(m => {
                    const msg = m.val();
                    box.innerHTML += `<div class="m ${msg.s === 'u' ? 'user' : 'admin'}">${msg.t}</div>`;
                });
                box.scrollTop = box.scrollHeight;
            });
        }

        function nav(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.getElementById('menu').style.display = id === 'screen-login' ? 'none' : 'flex';
            if(id === 'screen-support') loadChat();
            if(id === 'screen-home') update();
        }

        function toggleTheme() {
            document.body.classList.toggle('dark');
            localStorage.theme = document.body.classList.contains('dark') ? 'dark' : 'light';
        }
        function openModal(id) { document.getElementById('modal-'+id).style.display = 'flex'; }
        function closeModal() { document.querySelectorAll('.modal').forEach(m => m.style.display = 'none'); }
    </script>
</body>
</html>
