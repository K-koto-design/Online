<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>K-Online | Fixed Navigation</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <style>
        :root {
            --bg-dark: #010a0c;
            --accent-green: #14f195;
            --yellow-btn: #ffcc33;
            --card-bg: #1a2a2a;
            --white: #ffffff;
            --gray-bg: #eef1f2;
        }

        * { box-sizing: border-box; font-family: -apple-system, sans-serif; -webkit-tap-highlight-color: transparent; }
        
        /* –ì–ª–∞–≤–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: —ç–∫—Ä–∞–Ω—ã –∞–±—Å–æ–ª—é—Ç–Ω–æ —Å–∫—Ä—ã—Ç—ã, –∫–æ–≥–¥–∞ –Ω–µ –∞–∫—Ç–∏–≤–Ω—ã */
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; }
        
        .screen { 
            display: none; 
            width: 100%; 
            height: 100%; 
            position: absolute; 
            top: 0; 
            left: 0; 
            overflow-y: auto; 
            background: var(--white);
        }
        
        .screen.active { display: block; }

        /* –≠–ö–†–ê–ù –í–•–û–î–ê */
        #screen-auth { background: var(--bg-dark); color: white; display: flex; align-items: center; justify-content: center; z-index: 100; }
        .auth-container { width: 90%; max-width: 400px; text-align: center; }
        .auth-input { width: 100%; padding: 18px; border-radius: 18px; border: none; background: white; margin-bottom: 15px; font-size: 18px; text-align: center; color: #000; }
        .login-btn { width: 100%; padding: 18px; border-radius: 18px; border: none; background: var(--accent-green); font-weight: bold; font-size: 18px; cursor: pointer; }

        /* –í–ï–†–•–ù–Ø–Ø –ß–ê–°–¢–¨ –ì–õ–ê–í–ù–û–ô */
        .header-section {
            background: linear-gradient(180deg, #051417, #0b2e2a);
            padding: 50px 0 30px 0;
            border-bottom-left-radius: 30px;
            border-bottom-right-radius: 30px;
            color: white;
        }

        .main-scroll { display: flex; gap: 12px; overflow-x: auto; padding: 0 20px; }
        .main-scroll::-webkit-scrollbar { display: none; }

        .narrow-btn {
            min-width: 50px; height: 160px;
            background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);
            border-radius: 20px; display: flex; align-items: center; justify-content: center; font-size: 20px;
        }

        .tall-card {
            min-width: 150px; height: 160px;
            background: var(--card-bg); border-radius: 25px; padding: 18px;
            display: flex; flex-direction: column; justify-content: space-between;
        }

        /* –ë–õ–û–ö–ò –° –¢–†–ê–¢–ê–ú–ò –ò –ö–†–ï–î–ò–¢–û–ú */
        .white-content { padding: 25px 20px; display: flex; flex-direction: column; gap: 15px; }
        .info-row { display: flex; gap: 10px; align-items: stretch; height: 100px; }
        .info-box { 
            background: var(--gray-bg); padding: 15px 20px; border-radius: 20px; flex-grow: 1;
            display: flex; flex-direction: column; justify-content: center;
        }
        .info-box span { color: #666; font-size: 14px; }
        .info-box b { font-size: 24px; margin-top: 5px; }
        .yellow-arrow { 
            background: var(--yellow-btn); width: 65px; border-radius: 20px; 
            display: flex; align-items: center; justify-content: center; font-size: 24px; cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        /* –≠–ö–†–ê–ù –ö–ê–†–¢–´ */
        .card-view-header { text-align: center; padding: 40px 20px; }
        .action-circles { display: flex; justify-content: space-around; padding: 10px 20px; }
        .circle-item { text-align: center; font-size: 12px; font-weight: 500; }
        .circle-icon { width: 55px; height: 55px; background: var(--gray-bg); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 22px; margin-bottom: 8px; }
        
        .h-item { display: flex; justify-content: space-between; padding: 15px 20px; border-bottom: 1px solid #eee; }
    </style>
</head>
<body>

    <div id="screen-auth" class="screen active">
        <div class="auth-container">
            <h1 style="margin-bottom:30px;">–í—Ö–æ–¥ –≤ –û–Ω–ª–∞–π–Ω</h1>
            <input type="text" id="loginId" class="auth-input" placeholder="–ù–æ–º–µ—Ä –∏–ª–∏ –∏–º—è">
            <input type="password" id="loginPin" class="auth-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            <button class="login-btn" onclick="handleAuth()">–í–æ–π—Ç–∏</button>
            <p style="opacity:0.4; margin-top:20px;" onclick="location.reload()">–û–±–Ω–æ–≤–∏—Ç—å ‚Üª</p>
        </div>
    </div>

    <div id="screen-home" class="screen">
        <div class="header-section">
            <h2 id="helloName" style="margin: 0 20px 20px;">–ü—Ä–∏–≤–µ—Ç</h2>
            <div class="main-scroll">
                <div class="narrow-btn" onclick="alert('–û–±–º–µ–Ω')">üí±</div>
                <div class="narrow-btn" onclick="navTo('screen-transfer')">üíµ</div>
                <div class="tall-card" onclick="openCardView('debit')">
                    <span style="font-size: 11px; opacity: 0.6;">MIR DEBIT</span>
                    <div id="userBal" style="font-size: 20px; font-weight: 800;">0 ‚ÇΩ</div>
                    <span style="font-size: 11px; opacity: 0.4;">‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 4002</span>
                </div>
                <div id="creditCardUI" class="tall-card" style="display:none; border: 1px solid #f1c40f;" onclick="openCardView('credit')">
                    <span style="font-size: 11px; color: #f1c40f;">CREDIT CARD</span>
                    <div id="creditBalUI" style="font-size: 20px; font-weight: 800;">0 ‚ÇΩ</div>
                    <span style="font-size: 11px; opacity: 0.4;">‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 5500</span>
                </div>
            </div>
        </div>

        <div class="white-content">
            <div class="info-row">
                <div class="info-box">
                    <span>–¢—Ä–∞—Ç –≤ –î–µ–∫–∞–±—Ä–µ</span>
                    <b id="monthlySpends">2000 ‚ÇΩ</b>
                </div>
                <div class="yellow-arrow" onclick="alert('–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞—Ç')">‚ûî</div>
            </div>

            <div class="info-row">
                <div class="info-box">
                    <span>–í–∑—è—Ç—å –∫—Ä–µ–¥–∏—Ç</span>
                    <b>–ü–æ–¥ 15%</b>
                </div>
                <div class="yellow-arrow" onclick="navTo('screen-loan')">‚ûî</div>
            </div>
        </div>
    </div>

    <div id="screen-card-view" class="screen">
        <div style="padding: 20px; font-size: 20px; font-weight: bold;" onclick="navTo('screen-home')">‚Üê <span id="viewTitle">–ö–∞—Ä—Ç–∞</span></div>
        <div class="card-view-header">
            <div id="viewBal" style="font-size: 38px; font-weight: 800;">0 ‚ÇΩ</div>
            <div style="background:#e8f5e9; color:#2e7d32; padding:5px 15px; border-radius:20px; display:inline-block; margin-top:10px;">‚≠ê <span id="viewBonus">0</span> –°–ø–∞—Å–∏–±–æ</div>
        </div>
        <div class="action-circles">
            <div class="circle-item" onclick="navTo('screen-transfer')"><div class="circle-icon">‚ÜóÔ∏è</div>–ü–µ—Ä–µ–≤–µ—Å—Ç–∏</div>
            <div class="circle-item" onclick="alert('–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ')"><div class="circle-icon">üì•</div>–ü–æ–ø–æ–ª–Ω–∏—Ç—å</div>
            <div class="circle-item" onclick="alert('QR')"><div class="circle-icon">üì∑</div>QR-–∫–æ–¥</div>
            <div class="circle-item" onclick="alert('–£—Å–ª—É–≥–∏')"><div class="circle-icon">üì±</div>–£—Å–ª—É–≥–∏</div>
        </div>
        <div style="padding: 20px 20px 10px;"><b>–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</b></div>
        <div id="viewHistory"></div>
    </div>

    <script>
        const firebaseConfig = { 
            apiKey: "AIzaSyA3J7KnUgxUHZigwRKmndm7xyxJeeLCrxg", 
            authDomain: "webapp-b7149.firebaseapp.com", 
            databaseURL: "https://webapp-b7149-default-rtdb.europe-west1.firebasedatabase.app", 
            projectId: "webapp-b7149", 
            storageBucket: "webapp-b7149.firebasestorage.app", 
            messagingSenderId: "1034835242406", 
            appId: "1:1034835242406:web:98499dc1edbb83e4b8f367" 
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let users = []; let curUser = null;

        db.ref('clients').on('value', snap => {
            const data = snap.val();
            users = data ? Object.keys(data).map(k => ({...data[k], fbKey: k})) : [];
        });

        function handleAuth() {
            const id = document.getElementById('loginId').value.trim();
            const pin = document.getElementById('loginPin').value.trim();
            const user = users.find(u => (u.name === id || u.phone === id) && u.clientPin === pin);
            
            if(user) {
                curUser = user;
                document.getElementById('helloName').innerText = "–ü—Ä–∏–≤–µ—Ç, " + curUser.name;
                updateMainUI();
                navTo('screen-home'); // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —ç–∫—Ä–∞–Ω
            } else {
                alert("–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞");
            }
        }

        function navTo(screenId) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —ç–∫—Ä–∞–Ω—ã
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–π
            document.getElementById(screenId).classList.add('active');
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–∫—Ä–æ–ª–ª –≤–≤–µ—Ä—Ö
            document.getElementById(screenId).scrollTop = 0;
        }

        function updateMainUI() {
            document.getElementById('userBal').innerText = (curUser.balance || 0).toLocaleString() + " ‚ÇΩ";
            if(curUser.hasCredit) {
                document.getElementById('creditCardUI').style.display = "flex";
                document.getElementById('creditBalUI').innerText = (curUser.creditBalance || 0).toLocaleString() + " ‚ÇΩ";
            }
        }

        function openCardView(type) {
            const isCredit = type === 'credit';
            document.getElementById('viewTitle').innerText = isCredit ? "–ö—Ä–µ–¥–∏—Ç–Ω–∞—è –∫–∞—Ä—Ç–∞" : "–î–µ–±–µ—Ç–æ–≤–∞—è –∫–∞—Ä—Ç–∞";
            document.getElementById('viewBal').innerText = (isCredit ? curUser.creditBalance : curUser.balance).toLocaleString() + " ‚ÇΩ";
            document.getElementById('viewBonus').innerText = curUser.bonus || 0;
            
            const hBox = document.getElementById('viewHistory');
            if (curUser.history) {
                hBox.innerHTML = Object.values(curUser.history).reverse().map(h => `
                    <div class="h-item">
                        <div><b>${h.title || '–û–ø–µ—Ä–∞—Ü–∏—è'}</b></div>
                        <b>${h.sum || 0} ‚ÇΩ</b>
                    </div>
                `).join('');
            } else {
                hBox.innerHTML = "<p style='text-align:center; padding:20px; color:#999;'>–ù–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π</p>";
            }
            navTo('screen-card-view');
        }
    </script>
</body>
</html>
